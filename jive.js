var _=function(){function e(e,t,r){r=(r||0)-1;for(var n=e?e.length:0;++r<n;)if(e[r]===t)return r;return-1}function t(t,r){var n=typeof r;if(t=t.l,"boolean"==n||null==r)return t[r]?0:-1;"number"!=n&&"string"!=n&&(n="object");var i="number"==n?r:g+r;return t=(t=t[n])&&t[i],"object"==n?t&&-1<e(t,r)?0:-1:t?0:-1}function r(e){var t=this.l,r=typeof e;if("boolean"==r||null==e)t[e]=true;else{"number"!=r&&"string"!=r&&(r="object");var n="number"==r?e:g+e,t=t[r]||(t[r]={});"object"==r?(t[n]||(t[n]=[])).push(e):t[n]=true}}function n(e){return e.charCodeAt(0)}function i(e,t){for(var r=e.m,n=t.m,i=-1,o=r.length;++i<o;){var a=r[i],s=n[i];if(a!==s){if(a>s||typeof a=="undefined")return 1;if(a<s||typeof s=="undefined")return-1}}return e.n-t.n}function o(e){var t=-1,n=e.length,i=e[0],o=e[n/2|0],a=e[n-1];if(i&&typeof i=="object"&&o&&typeof o=="object"&&a&&typeof a=="object")return false;for(i=u(),i["false"]=i["null"]=i["true"]=i.undefined=false,o=u(),o.k=e,o.l=i,o.push=r;++t<n;)o.push(e[t]);return o}function a(e){return"\\"+L[e]}function s(){return d.pop()||[]}function u(){return v.pop()||{k:null,l:null,m:null,"false":false,n:0,"null":false,number:null,object:null,push:null,string:null,"true":false,undefined:false,o:null}}function f(e){e.length=0,d.length<b&&d.push(e)}function l(e){var t=e.l;t&&l(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,v.length<b&&v.push(e)}function c(e,t,r){t||(t=0),typeof r=="undefined"&&(r=e?e.length:0);var n=-1;r=r-t||0;for(var i=Array(0>r?0:r);++n<r;)i[n]=e[t+n];return i}function p(r){function d(e,t,r){if(!e||!J[typeof e])return e;t=t&&typeof r=="undefined"?t:Z(t,r,3);var n=e.length;if(r=-1,n&&dt(e))for(;++r<n&&(r+="",false!==t(e[r],r,e)););else for(r in n=typeof e=="function",e)if((!n||"prototype"!=r)&&dr.call(e,r)&&false===t(e[r],r,e))break;return e}function v(e,t,r){if(!e||!J[typeof e])return e;t=t&&typeof r=="undefined"?t:Z(t,r,3);var n=e.length;if(r=-1,n&&dt(e))for(;++r<n&&(r+="",false!==t(e[r],r,e)););else for(r in n=typeof e=="function",e)if((!n||"prototype"!=r)&&false===t(e[r],r,e))break;return e}function b(e,t,r){var n,i=e,o=i;if(!i)return o;for(var a=arguments,s=0,u=typeof r=="number"?2:a.length;++s<u;)if((i=a[s])&&J[typeof i]){var f=i.length;if(n=-1,f&&dt(i))for(;++n<f;)n+="","undefined"==typeof o[n]&&(o[n]=i[n]);else for(n in f=typeof i=="function",i)f&&"prototype"==n||!dr.call(i,n)||"undefined"==typeof o[n]&&(o[n]=i[n])}return o}function L(e,t,r){var n,i=e,o=i;if(!i)return o;var a=arguments,s=0,u=typeof r=="number"?2:a.length;if(3<u&&"function"==typeof a[u-2])var f=Z(a[--u-1],a[u--],2);else 2<u&&"function"==typeof a[u-1]&&(f=a[--u]);for(;++s<u;)if((i=a[s])&&J[typeof i]){var l=i.length;if(n=-1,l&&dt(i))for(;++n<l;)n+="",o[n]=f?f(o[n],i[n]):i[n];else for(n in l=typeof i=="function",i)l&&"prototype"==n||!dr.call(i,n)||(o[n]=f?f(o[n],i[n]):i[n])}return o}function Y(e,t,r){if(!e)return e;t=t&&typeof r=="undefined"?t:Z(t,r,3);var n=e.length;if(r=-1,typeof n=="number")for(;++r<n&&false!==t(e[r],r,e););else for(r in n=typeof e=="function",e)if((!n||"prototype"!=r)&&dr.call(e,r)&&false===t(e[r],r,e))break;return e}function $(e){var t,r=[];if(!e||!J[typeof e])return r;var n=e.length;if(t=-1,n&&dt(e))for(;++t<n;)t+="",r.push(t);else for(t in n=typeof e=="function",e)n&&"prototype"==t||!dr.call(e,t)||r.push(t);return r}function W(e){return e&&typeof e=="object"&&!Ar(e)&&dr.call(e,"__wrapped__")?e:new H(e)}function H(e,t){this.__chain__=!!t,this.__wrapped__=e}function X(e){function t(){if(n){var e=c(n);vr.apply(e,arguments)}if(this instanceof t){var o=G(r.prototype),e=r.apply(o,e||arguments);return bt(e)?e:o}return r.apply(i,e||arguments)}var r=e[0],n=e[2],i=e[4];return t}function Q(e,t,r,n,i){if(r){var o=r(e);if(typeof o!="undefined")return o}if(!bt(e))return e;var a=ur.call(e);if(!z[a])return e;var u=Sr[a];switch(a){case F:case P:return new u(+e);case N:case I:return new u(e);case R:return o=u(e.source,E.exec(e)),o.lastIndex=e.lastIndex,o}if(a=Ar(e),t){var l=!n;n||(n=s()),i||(i=s());for(var p=n.length;p--;)if(n[p]==e)return i[p];o=a?u(e.length):{}}else o=a?c(e):L({},e);return a&&(dr.call(e,"index")&&(o.index=e.index),dr.call(e,"input")&&(o.input=e.input)),t?(n.push(e),i.push(o),(a?Y:d)(e,function(e,a){o[a]=Q(e,t,r,n,i)}),l&&(f(n),f(i)),o):o}function G(e){return bt(e)?br(e):{}}function Z(e,t,r){if(typeof e!="function")return Vt;if(typeof t=="undefined"||!("prototype"in e))return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return Jt(e,t)}function et(e){function t(){var e=u?a:this;if(i){var d=c(i);vr.apply(d,arguments)}return(o||l)&&(d||(d=c(arguments)),o&&vr.apply(d,o),l&&d.length<s)?(n|=16,et([r,p?n:-4&n,d,null,a,s])):(d||(d=arguments),f&&(r=e[h]),this instanceof t?(e=G(r.prototype),d=r.apply(e,d),bt(d)?d:e):r.apply(e,d))}var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=1&n,f=2&n,l=4&n,p=8&n,h=r;return t}function tt(r,n){var i=-1,a=lt(),s=r?r.length:0,u=s>=m&&a===e,f=[];if(u){var c=o(n);c?(a=t,n=c):u=false}for(;++i<s;)c=r[i],0>a(n,c)&&f.push(c);return u&&l(n),f}function rt(e,t,r,n){n=(n||0)-1;for(var i=e?e.length:0,o=[];++n<i;){var a=e[n];if(a&&typeof a=="object"&&typeof a.length=="number"&&(Ar(a)||dt(a))){t||(a=rt(a,t,r));var s=-1,u=a.length,f=o.length;for(o.length+=u;++s<u;)o[f++]=a[s]}else r||o.push(a)}return o}function nt(e,t,r,n,i,o){if(r){var a=r(e,t);if(typeof a!="undefined")return!!a}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&J[typeof e]||t&&J[typeof t]))return false;if(null==e||null==t)return e===t;var u=ur.call(e),l=ur.call(t);if(u==T&&(u=M),l==T&&(l=M),u!=l)return false;switch(u){case F:case P:return+e==+t;case N:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case R:case I:return e==rr(t)}if(l=u==B,!l){var c=dr.call(e,"__wrapped__"),p=dr.call(t,"__wrapped__");if(c||p)return nt(c?e.__wrapped__:e,p?t.__wrapped__:t,r,n,i,o);if(u!=M)return false;if(u=e.constructor,c=t.constructor,u!=c&&!(mt(u)&&u instanceof u&&mt(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return false}for(u=!i,i||(i=s()),o||(o=s()),c=i.length;c--;)if(i[c]==e)return o[c]==t;var h=0,a=true;if(i.push(e),o.push(t),l){if(c=e.length,h=t.length,(a=h==c)||n)for(;h--;)if(l=c,p=t[h],n)for(;l--&&!(a=nt(e[l],p,r,n,i,o)););else if(!(a=nt(e[h],p,r,n,i,o)))break}else v(t,function(t,s,u){return dr.call(u,s)?(h++,a=dr.call(e,s)&&nt(e[s],t,r,n,i,o)):void 0}),a&&!n&&v(e,function(e,t,r){return dr.call(r,t)?a=-1<--h:void 0});return i.pop(),o.pop(),u&&(f(i),f(o)),a}function it(e,t,r,n,i){(Ar(t)?Ot:d)(t,function(t,o){var a,s,u=t,f=e[o];if(t&&((s=Ar(t))||Nr(t))){for(u=n.length;u--;)if(a=n[u]==t){f=i[u];break}if(!a){var l;r&&(u=r(f,t),l=typeof u!="undefined")&&(f=u),l||(f=s?Ar(f)?f:[]:Nr(f)?f:{}),n.push(t),i.push(f),l||it(f,t,r,n,i)}}else r&&(u=r(f,t),typeof u=="undefined"&&(u=t)),typeof u!="undefined"&&(f=u);e[o]=f})}function ot(e,t){return e+pr(Or()*(t-e+1))}function at(r,n,i){var a=-1,u=lt(),c=r?r.length:0,p=[],h=!n&&c>=m&&u===e,d=i||h?s():p;for(h&&(d=o(d),u=t);++a<c;){var v=r[a],y=i?i(v,a,r):v;(n?!a||d[d.length-1]!==y:0>u(d,y))&&((i||h)&&d.push(y),p.push(v))}return h?(f(d.k),l(d)):i&&f(d),p}function st(e){return function(t,r,n){var i={};if(r=W.createCallback(r,n,3),Ar(t)){n=-1;for(var o=t.length;++n<o;){var a=t[n];e(i,a,r(a,n,t),t)}}else Y(t,function(t,n,o){e(i,t,r(t,n,o),o)});return i}}function ut(e,t,r,n,i,o){var a=16&t,s=32&t;if(!(2&t||mt(e)))throw new nr;return a&&!r.length&&(t&=-17,r=false),s&&!n.length&&(t&=-33,n=false),(1==t||17===t?X:et)([e,t,r,n,i,o])}function ft(e){return Br[e]}function lt(){var t=(t=W.indexOf)===Nt?e:t;return t}function ct(e){return typeof e=="function"&&fr.test(e)}function pt(e){var t,r;return e&&ur.call(e)==M&&(t=e.constructor,!mt(t)||t instanceof t)?(v(e,function(e,t){r=t}),typeof r=="undefined"||dr.call(e,r)):false}function ht(e){return Fr[e]}function dt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ur.call(e)==T||false}function vt(e,t,r){var n=Tr(e),i=n.length;for(t=Z(t,r,3);i--&&(r=n[i],false!==t(e[r],r,e)););return e}function yt(e){var t=[];return v(e,function(e,r){mt(e)&&t.push(r)}),t.sort()}function gt(e){for(var t=-1,r=Tr(e),n=r.length,i={};++t<n;){var o=r[t];i[e[o]]=o}return i}function mt(e){return typeof e=="function"}function bt(e){return!(!e||!J[typeof e])}function _t(e){return typeof e=="number"||e&&typeof e=="object"&&ur.call(e)==N||false}function Dt(e){return typeof e=="string"||e&&typeof e=="object"&&ur.call(e)==I||false}function wt(e){for(var t=-1,r=Tr(e),n=r.length,i=Ht(n);++t<n;)i[t]=e[r[t]];return i}function jt(e,t,r){var n=-1,i=lt(),o=e?e.length:0,a=false;return r=(0>r?kr(0,o+r):r)||0,Ar(e)?a=-1<i(e,t,r):typeof o=="number"?a=-1<(Dt(e)?e.indexOf(t,r):i(e,t,r)):Y(e,function(e){return++n<r?void 0:!(a=e===t)}),a}function kt(e,t,r){var n=true;if(t=W.createCallback(t,r,3),Ar(e)){r=-1;for(var i=e.length;++r<i&&(n=!!t(e[r],r,e)););}else Y(e,function(e,r,i){return n=!!t(e,r,i)});return n}function Et(e,t,r){var n=[];if(t=W.createCallback(t,r,3),Ar(e)){r=-1;for(var i=e.length;++r<i;){var o=e[r];t(o,r,e)&&n.push(o)}}else Y(e,function(e,r,i){t(e,r,i)&&n.push(e)});return n}function Ct(e,t,r){if(t=W.createCallback(t,r,3),!Ar(e)){var n;return Y(e,function(e,r,i){return t(e,r,i)?(n=e,false):void 0}),n}r=-1;for(var i=e.length;++r<i;){var o=e[r];if(t(o,r,e))return o}}function Ot(e,t,r){if(t&&typeof r=="undefined"&&Ar(e)){r=-1;for(var n=e.length;++r<n&&false!==t(e[r],r,e););}else Y(e,t,r);return e}function St(e,t,r){var n=e?e.length:0;if(t=t&&typeof r=="undefined"?t:Z(t,r,3),Ar(e))for(;n--&&false!==t(e[n],n,e););else{if(typeof n!="number")var i=Tr(e),n=i.length;Y(e,function(r,o,a){return o=i?i[--n]:--n,t(e[o],o,a)})}return e}function xt(e,t,r){var n=-1,i=e?e.length:0,o=Ht(typeof i=="number"?i:0);if(t=W.createCallback(t,r,3),Ar(e))for(;++n<i;)o[n]=t(e[n],n,e);else Y(e,function(e,r,i){o[++n]=t(e,r,i)});return o}function At(e,t,r){var i=-1/0,o=i;if(typeof t!="function"&&r&&r[t]===e&&(t=null),null==t&&Ar(e)){r=-1;for(var a=e.length;++r<a;){var s=e[r];s>o&&(o=s)}}else t=null==t&&Dt(e)?n:W.createCallback(t,r,3),Y(e,function(e,r,n){r=t(e,r,n),r>i&&(i=r,o=e)});return o}function Tt(e,t,r,n){var i=3>arguments.length;if(t=W.createCallback(t,n,4),Ar(e)){var o=-1,a=e.length;for(i&&(r=e[++o]);++o<a;)r=t(r,e[o],o,e)}else Y(e,function(e,n,o){r=i?(i=false,e):t(r,e,n,o)});return r}function Bt(e,t,r,n){var i=3>arguments.length;return t=W.createCallback(t,n,4),St(e,function(e,n,o){r=i?(i=false,e):t(r,e,n,o)}),r}function Ft(e){var t=-1,r=e?e.length:0,n=Ht(typeof r=="number"?r:0);return Ot(e,function(e){var r=ot(0,++t);n[t]=n[r],n[r]=e}),n}function Pt(e,t,r){var n;if(t=W.createCallback(t,r,3),Ar(e)){r=-1;for(var i=e.length;++r<i&&!(n=t(e[r],r,e)););}else Y(e,function(e,r,i){return!(n=t(e,r,i))});return!!n}function Ut(e,t,r){var n=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=-1;for(t=W.createCallback(t,r,3);++o<i&&t(e[o],o,e);)n++}else if(n=t,null==n||r)return e?e[0]:h;return c(e,0,Er(kr(0,n),i))}function Nt(t,r,n){if(typeof n=="number"){var i=t?t.length:0;n=0>n?kr(0,i+n):n||0}else if(n)return n=Rt(t,r),t[n]===r?n:-1;return e(t,r,n)}function Mt(e,t,r){if(typeof t!="number"&&null!=t){var n=0,i=-1,o=e?e.length:0;for(t=W.createCallback(t,r,3);++i<o&&t(e[i],i,e);)n++}else n=null==t||r?1:kr(0,t);return c(e,n)}function Rt(e,t,r,n){var i=0,o=e?e.length:i;for(r=r?W.createCallback(r,n,1):Vt,t=r(t);i<o;)n=i+o>>>1,r(e[n])<t?i=n+1:o=n;return i}function It(e,t,r,n){return typeof t!="boolean"&&null!=t&&(n=r,r=typeof t!="function"&&n&&n[t]===e?null:t,t=false),null!=r&&(r=W.createCallback(r,n,3)),at(e,t,r)}function zt(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,r=e?At(zr(e,"length")):0,n=Ht(0>r?0:r);++t<r;)n[t]=zr(e,t);return n}function qt(e,t){var r=-1,n=e?e.length:0,i={};for(t||!n||Ar(e[0])||(t=[]);++r<n;){var o=e[r];t?i[o]=t[r]:o&&(i[o[0]]=o[1])}return i}function Jt(e,t){return 2<arguments.length?ut(e,17,c(arguments,2),null,t):ut(e,1,null,null,t)}function Lt(e,t,r){function n(){l&&cr(l),a=l=c=h,(v||d!==t)&&(p=qr(),s=e.apply(f,o),l||a||(o=f=null))}function i(){var r=t-(qr()-u);0<r?l=gr(i,r):(a&&cr(a),r=c,a=l=c=h,r&&(p=qr(),s=e.apply(f,o),l||a||(o=f=null)))}var o,a,s,u,f,l,c,p=0,d=false,v=true;if(!mt(e))throw new nr;if(t=kr(0,t)||0,true===r)var y=true,v=false;else bt(r)&&(y=r.leading,d="maxWait"in r&&(kr(t,r.maxWait)||0),v="trailing"in r?r.trailing:v);return function(){if(o=arguments,u=qr(),f=this,c=v&&(l||!y),false===d)var r=y&&!l;else{a||y||(p=u);var h=d-(u-p),g=0>=h;g?(a&&(a=cr(a)),p=u,s=e.apply(f,o)):a||(a=gr(n,h))}return g&&l?l=cr(l):l||t===d||(l=gr(i,t)),r&&(g=true,s=e.apply(f,o)),!g||l||a||(o=f=null),s}}function Vt(e){return e}function Yt(e,t,r){var n=true,i=t&&yt(t);t&&(r||i.length)||(null==r&&(r=t),o=H,t=e,e=W,i=yt(t)),false===r?n=false:bt(r)&&"chain"in r&&(n=r.chain);var o=e,a=mt(o);Ot(i,function(r){var i=e[r]=t[r];a&&(o.prototype[r]=function(){var t=this.__chain__,r=this.__wrapped__,a=[r];if(vr.apply(a,arguments),a=i.apply(e,a),n||t){if(r===a&&bt(a))return this;a=new o(a),a.__chain__=t}return a})})}function $t(e){return function(t){return t[e]}}function Wt(){return this.__wrapped__}r=r?K.defaults(V.Object(),r,K.pick(V,A)):V;var Ht=r.Array,Kt=r.Boolean,Xt=r.Date,Qt=r.Function,Gt=r.Math,Zt=r.Number,er=r.Object,tr=r.RegExp,rr=r.String,nr=r.TypeError,ir=[],or=r.Error.prototype,ar=er.prototype,sr=r._,ur=ar.toString,fr=tr("^"+rr(ur).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),lr=Gt.ceil,cr=r.clearTimeout,pr=Gt.floor,hr=ct(hr=er.getPrototypeOf)&&hr,dr=ar.hasOwnProperty,vr=ir.push,yr=ar.propertyIsEnumerable,gr=r.setTimeout,mr=ir.splice,br=ct(br=er.create)&&br,_r=ct(_r=Ht.isArray)&&_r,Dr=r.isFinite,wr=r.isNaN,jr=ct(jr=er.keys)&&jr,kr=Gt.max,Er=Gt.min,Cr=r.parseInt,Or=Gt.random,Sr={};Sr[B]=Ht,Sr[F]=Kt,Sr[P]=Xt,Sr[U]=Qt,Sr[M]=er,Sr[N]=Zt,Sr[R]=tr,Sr[I]=rr,H.prototype=W.prototype;var xr=W.support={};xr.enumErrorProps=yr.call(or,"message")||yr.call(or,"name"),xr.enumPrototypes=true,xr.nonEnumArgs=true,W.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:C,variable:"",imports:{_:W}},br||(G=function(){function e(){}return function(t){if(bt(t)){e.prototype=t;var n=new e;e.prototype=null}return n||r.Object()}}());var Ar=_r||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ur.call(e)==B||false},Tr=jr?function(e){return bt(e)?xr.enumPrototypes&&typeof e=="function"||xr.nonEnumArgs&&e.length&&dt(e)?$(e):jr(e):[]}:$,Br={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Fr=gt(Br),Pr=tr("("+Tr(Fr).join("|")+")","g"),Ur=tr("["+Tr(Br).join("")+"]","g");mt(/x/)&&(mt=function(e){return typeof e=="function"&&ur.call(e)==U});var Nr=hr?function(e){if(!e||ur.call(e)!=M)return false;var t=e.valueOf,r=ct(t)&&(r=hr(t))&&hr(r);return r?e==r||hr(e)==r:pt(e)}:pt,Mr=st(function(e,t,r){dr.call(e,r)?e[r]++:e[r]=1}),Rr=st(function(e,t,r){(dr.call(e,r)?e[r]:e[r]=[]).push(t)}),Ir=st(function(e,t,r){e[r]=t}),zr=xt,qr=ct(qr=Xt.now)&&qr||function(){return(new Xt).getTime()},Jr=8==Cr(_+"08")?Cr:function(e,t){return Cr(Dt(e)?e.replace(O,""):e,t||0)};return W.after=function(e,t){if(!mt(t))throw new nr;return function(){return 1>--e?t.apply(this,arguments):void 0}},W.assign=L,W.at=function(e){for(var t=arguments,r=-1,n=rt(t,true,false,1),t=t[2]&&t[2][t[1]]===e?1:n.length,i=Ht(t);++r<t;)i[r]=e[n[r]];return i},W.bind=Jt,W.bindAll=function(e){for(var t=1<arguments.length?rt(arguments,true,false,1):yt(e),r=-1,n=t.length;++r<n;){var i=t[r];e[i]=ut(e[i],1,null,null,e)}return e},W.bindKey=function(e,t){return 2<arguments.length?ut(t,19,c(arguments,2),null,e):ut(t,3,null,null,e)},W.chain=function(e){return e=new H(e),e.__chain__=true,e},W.compact=function(e){for(var t=-1,r=e?e.length:0,n=[];++t<r;){var i=e[t];i&&n.push(i)}return n},W.compose=function(){for(var e=arguments,t=e.length;t--;)if(!mt(e[t]))throw new nr;return function(){for(var t=arguments,r=e.length;r--;)t=[e[r].apply(this,t)];return t[0]}},W.constant=function(e){return function(){return e}},W.countBy=Mr,W.create=function(e,t){var r=G(e);return t?L(r,t):r},W.createCallback=function(e,t,r){var n=typeof e;if(null==e||"function"==n)return Z(e,t,r);if("object"!=n)return $t(e);var i=Tr(e),o=i[0],a=e[o];return 1!=i.length||a!==a||bt(a)?function(t){for(var r=i.length,n=false;r--&&(n=nt(t[i[r]],e[i[r]],null,true)););return n}:function(e){return e=e[o],a===e&&(0!==a||1/a==1/e)}},W.curry=function(e,t){return t=typeof t=="number"?t:+t||e.length,ut(e,4,null,null,null,t)},W.debounce=Lt,W.defaults=b,W.defer=function(e){if(!mt(e))throw new nr;var t=c(arguments,1);return gr(function(){e.apply(h,t)},1)},W.delay=function(e,t){if(!mt(e))throw new nr;var r=c(arguments,2);return gr(function(){e.apply(h,r)},t)},W.difference=function(e){return tt(e,rt(arguments,true,true,1))},W.filter=Et,W.flatten=function(e,t,r,n){return typeof t!="boolean"&&null!=t&&(n=r,r=typeof t!="function"&&n&&n[t]===e?null:t,t=false),null!=r&&(e=xt(e,r,n)),rt(e,t)},W.forEach=Ot,W.forEachRight=St,W.forIn=v,W.forInRight=function(e,t,r){var n=[];v(e,function(e,t){n.push(t,e)});var i=n.length;for(t=Z(t,r,3);i--&&false!==t(n[i--],n[i],e););return e},W.forOwn=d,W.forOwnRight=vt,W.functions=yt,W.groupBy=Rr,W.indexBy=Ir,W.initial=function(e,t,r){var n=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=i;for(t=W.createCallback(t,r,3);o--&&t(e[o],o,e);)n++}else n=null==t||r?1:t||n;return c(e,0,Er(kr(0,i-n),i))},W.intersection=function(){for(var r=[],n=-1,i=arguments.length,a=s(),u=lt(),c=u===e,p=s();++n<i;){var h=arguments[n];(Ar(h)||dt(h))&&(r.push(h),a.push(c&&h.length>=m&&o(n?r[n]:p)))}var c=r[0],d=-1,v=c?c.length:0,y=[];e:for(;++d<v;){var g=a[0],h=c[d];if(0>(g?t(g,h):u(p,h))){for(n=i,(g||p).push(h);--n;)if(g=a[n],0>(g?t(g,h):u(r[n],h)))continue e;y.push(h)}}for(;i--;)(g=a[i])&&l(g);return f(a),f(p),y},W.invert=gt,W.invoke=function(e,t){var r=c(arguments,2),n=-1,i=typeof t=="function",o=e?e.length:0,a=Ht(typeof o=="number"?o:0);return Ot(e,function(e){a[++n]=(i?t:e[t]).apply(e,r)}),a},W.keys=Tr,W.map=xt,W.mapValues=function(e,t,r){var n={};return t=W.createCallback(t,r,3),d(e,function(e,r,i){n[r]=t(e,r,i)}),n},W.max=At,W.memoize=function(e,t){function r(){var n=r.cache,i=t?t.apply(this,arguments):g+arguments[0];return dr.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}if(!mt(e))throw new nr;return r.cache={},r},W.merge=function(e){var t=arguments,r=2;if(!bt(e))return e;if("number"!=typeof t[2]&&(r=t.length),3<r&&"function"==typeof t[r-2])var n=Z(t[--r-1],t[r--],2);else 2<r&&"function"==typeof t[r-1]&&(n=t[--r]);for(var t=c(arguments,1,r),i=-1,o=s(),a=s();++i<r;)it(e,t[i],n,o,a);return f(o),f(a),e},W.min=function(e,t,r){var i=1/0,o=i;if(typeof t!="function"&&r&&r[t]===e&&(t=null),null==t&&Ar(e)){r=-1;for(var a=e.length;++r<a;){var s=e[r];s<o&&(o=s)}}else t=null==t&&Dt(e)?n:W.createCallback(t,r,3),Y(e,function(e,r,n){r=t(e,r,n),r<i&&(i=r,o=e)});return o},W.omit=function(e,t,r){var n={};if(typeof t!="function"){var i=[];v(e,function(e,t){i.push(t)});for(var i=tt(i,rt(arguments,true,false,1)),o=-1,a=i.length;++o<a;){var s=i[o];n[s]=e[s]}}else t=W.createCallback(t,r,3),v(e,function(e,r,i){t(e,r,i)||(n[r]=e)});return n},W.once=function(e){var t,r;if(!mt(e))throw new nr;return function(){return t?r:(t=true,r=e.apply(this,arguments),e=null,r)}},W.pairs=function(e){for(var t=-1,r=Tr(e),n=r.length,i=Ht(n);++t<n;){var o=r[t];i[t]=[o,e[o]]}return i},W.partial=function(e){return ut(e,16,c(arguments,1))},W.partialRight=function(e){return ut(e,32,null,c(arguments,1))},W.pick=function(e,t,r){var n={};if(typeof t!="function")for(var i=-1,o=rt(arguments,true,false,1),a=bt(e)?o.length:0;++i<a;){var s=o[i];s in e&&(n[s]=e[s])}else t=W.createCallback(t,r,3),v(e,function(e,r,i){t(e,r,i)&&(n[r]=e)});return n},W.pluck=zr,W.property=$t,W.pull=function(e){for(var t=arguments,r=0,n=t.length,i=e?e.length:0;++r<n;)for(var o=-1,a=t[r];++o<i;)e[o]===a&&(mr.call(e,o--,1),i--);return e},W.range=function(e,t,r){e=+e||0,r=typeof r=="number"?r:+r||1,null==t&&(t=e,e=0);var n=-1;t=kr(0,lr((t-e)/(r||1)));for(var i=Ht(t);++n<t;)i[n]=e,e+=r;return i},W.reject=function(e,t,r){return t=W.createCallback(t,r,3),Et(e,function(e,r,n){return!t(e,r,n)})},W.remove=function(e,t,r){var n=-1,i=e?e.length:0,o=[];for(t=W.createCallback(t,r,3);++n<i;)r=e[n],t(r,n,e)&&(o.push(r),mr.call(e,n--,1),i--);return o},W.rest=Mt,W.shuffle=Ft,W.sortBy=function(e,t,r){var n=-1,o=Ar(t),a=e?e.length:0,c=Ht(typeof a=="number"?a:0);for(o||(t=W.createCallback(t,r,3)),Ot(e,function(e,r,i){var a=c[++n]=u();o?a.m=xt(t,function(t){return e[t]}):(a.m=s())[0]=t(e,r,i),a.n=n,a.o=e}),a=c.length,c.sort(i);a--;)e=c[a],c[a]=e.o,o||f(e.m),l(e);return c},W.tap=function(e,t){return t(e),e},W.throttle=function(e,t,r){var n=true,i=true;if(!mt(e))throw new nr;return false===r?n=false:bt(r)&&(n="leading"in r?r.leading:n,i="trailing"in r?r.trailing:i),q.leading=n,q.maxWait=t,q.trailing=i,Lt(e,t,q)},W.times=function(e,t,r){e=-1<(e=+e)?e:0;var n=-1,i=Ht(e);for(t=Z(t,r,1);++n<e;)i[n]=t(n);return i},W.toArray=function(e){return e&&typeof e.length=="number"?c(e):wt(e)},W.transform=function(e,t,r,n){var i=Ar(e);if(null==r)if(i)r=[];else{var o=e&&e.constructor;r=G(o&&o.prototype)}return t&&(t=W.createCallback(t,n,4),(i?Y:d)(e,function(e,n,i){return t(r,e,n,i)})),r},W.union=function(){return at(rt(arguments,true,true))},W.uniq=It,W.values=wt,W.where=Et,W.without=function(e){return tt(e,c(arguments,1))},W.wrap=function(e,t){return ut(t,16,[e])},W.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var r=arguments[e];if(Ar(r)||dt(r))var n=n?at(tt(n,r).concat(tt(r,n))):r}return n||[]},W.zip=zt,W.zipObject=qt,W.collect=xt,W.drop=Mt,W.each=Ot,W.eachRight=St,W.extend=L,W.methods=yt,W.object=qt,W.select=Et,W.tail=Mt,W.unique=It,W.unzip=zt,Yt(W),W.clone=function(e,t,r,n){return typeof t!="boolean"&&null!=t&&(n=r,r=t,t=false),Q(e,t,typeof r=="function"&&Z(r,n,1))},W.cloneDeep=function(e,t,r){return Q(e,true,typeof t=="function"&&Z(t,r,1))},W.contains=jt,W.escape=function(e){return null==e?"":rr(e).replace(Ur,ft)},W.every=kt,W.find=Ct,W.findIndex=function(e,t,r){var n=-1,i=e?e.length:0;for(t=W.createCallback(t,r,3);++n<i;)if(t(e[n],n,e))return n;return-1},W.findKey=function(e,t,r){var n;return t=W.createCallback(t,r,3),d(e,function(e,r,i){return t(e,r,i)?(n=r,false):void 0}),n},W.findLast=function(e,t,r){var n;return t=W.createCallback(t,r,3),St(e,function(e,r,i){return t(e,r,i)?(n=e,false):void 0}),n},W.findLastIndex=function(e,t,r){var n=e?e.length:0;for(t=W.createCallback(t,r,3);n--;)if(t(e[n],n,e))return n;return-1},W.findLastKey=function(e,t,r){var n;return t=W.createCallback(t,r,3),vt(e,function(e,r,i){return t(e,r,i)?(n=r,false):void 0}),n},W.has=function(e,t){return e?dr.call(e,t):false},W.identity=Vt,W.indexOf=Nt,W.isArguments=dt,W.isArray=Ar,W.isBoolean=function(e){return true===e||false===e||e&&typeof e=="object"&&ur.call(e)==F||false},W.isDate=function(e){return e&&typeof e=="object"&&ur.call(e)==P||false},W.isElement=function(e){return e&&1===e.nodeType||false},W.isEmpty=function(e){var t=true;if(!e)return t;var r=ur.call(e),n=e.length;return r==B||r==I||r==T||r==M&&typeof n=="number"&&mt(e.splice)?!n:(d(e,function(){return t=false}),t)},W.isEqual=function(e,t,r,n){return nt(e,t,typeof r=="function"&&Z(r,n,2))},W.isFinite=function(e){return Dr(e)&&!wr(parseFloat(e))},W.isFunction=mt,W.isNaN=function(e){return _t(e)&&e!=+e},W.isNull=function(e){return null===e},W.isNumber=_t,W.isObject=bt,W.isPlainObject=Nr,W.isRegExp=function(e){return e&&J[typeof e]&&ur.call(e)==R||false},W.isString=Dt,W.isUndefined=function(e){return typeof e=="undefined"},W.lastIndexOf=function(e,t,r){var n=e?e.length:0;for(typeof r=="number"&&(n=(0>r?kr(0,n+r):Er(r,n-1))+1);n--;)if(e[n]===t)return n;return-1},W.mixin=Yt,W.noConflict=function(){return r._=sr,this},W.noop=function(){},W.now=qr,W.parseInt=Jr,W.random=function(e,t,r){var n=null==e,i=null==t;return null==r&&(typeof e=="boolean"&&i?(r=e,e=1):i||typeof t!="boolean"||(r=t,i=true)),n&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,r||e%1||t%1?(r=Or(),Er(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)):ot(e,t)},W.reduce=Tt,W.reduceRight=Bt,W.result=function(e,t){if(e){var r=e[t];return mt(r)?e[t]():r}},W.runInContext=p,W.size=function(e){var t=e?e.length:0;return typeof t=="number"?t:Tr(e).length},W.some=Pt,W.sortedIndex=Rt,W.template=function(e,t,r){var n=W.templateSettings;e=rr(e||""),r=b({},r,n);var i,o=b({},r.imports,n.imports),n=Tr(o),o=wt(o),s=0,u=r.interpolate||S,f="__p+='",u=tr((r.escape||S).source+"|"+u.source+"|"+(u===C?k:S).source+"|"+(r.evaluate||S).source+"|$","g");e.replace(u,function(t,r,n,o,u,l){return n||(n=o),f+=e.slice(s,l).replace(x,a),r&&(f+="'+__e("+r+")+'"),u&&(i=true,f+="';"+u+";\n__p+='"),n&&(f+="'+((__t=("+n+"))==null?'':__t)+'"),s=l+t.length,t}),f+="';",u=r=r.variable,u||(r="obj",f="with("+r+"){"+f+"}"),f=(i?f.replace(D,""):f).replace(w,"$1").replace(j,"$1;"),f="function("+r+"){"+(u?"":r+"||("+r+"={});")+"var __t,__p='',__e=_.escape"+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+f+"return __p}";try{var l=Qt(n,"return "+f).apply(h,o)}catch(c){throw c.source=f,c}return t?l(t):(l.source=f,l)},W.unescape=function(e){return null==e?"":rr(e).replace(Pr,ht)},W.uniqueId=function(e){var t=++y;return rr(null==e?"":e)+t},W.all=kt,W.any=Pt,W.detect=Ct,W.findWhere=Ct,W.foldl=Tt,W.foldr=Bt,W.include=jt,W.inject=Tt,Yt(function(){var e={};return d(W,function(t,r){W.prototype[r]||(e[r]=t)}),e}(),false),W.first=Ut,W.last=function(e,t,r){var n=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=i;for(t=W.createCallback(t,r,3);o--&&t(e[o],o,e);)n++}else if(n=t,null==n||r)return e?e[i-1]:h;return c(e,kr(0,i-n))},W.sample=function(e,t,r){return e&&typeof e.length!="number"&&(e=wt(e)),null==t||r?e?e[ot(0,e.length-1)]:h:(e=Ft(e),e.length=Er(kr(0,t),e.length),e)},W.take=Ut,W.head=Ut,d(W,function(e,t){var r="sample"!==t;W.prototype[t]||(W.prototype[t]=function(t,n){var i=this.__chain__,o=e(this.__wrapped__,t,n);return i||null!=t&&(!n||r&&typeof t=="function")?new H(o,i):o})}),W.VERSION="2.4.1",W.prototype.chain=function(){return this.__chain__=true,this},W.prototype.toString=function(){return rr(this.__wrapped__)},W.prototype.value=Wt,W.prototype.valueOf=Wt,Y(["join","pop","shift"],function(e){var t=ir[e];W.prototype[e]=function(){var e=this.__chain__,r=t.apply(this.__wrapped__,arguments);return e?new H(r,e):r}}),Y(["push","reverse","sort","unshift"],function(e){var t=ir[e];W.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Y(["concat","slice","splice"],function(e){var t=ir[e];W.prototype[e]=function(){return new H(t.apply(this.__wrapped__,arguments),this.__chain__)}}),W}var h,d=[],v=[],y=0,g=+new Date+"",m=75,b=40,_=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",D=/\b__p\+='';/g,w=/\b(__p\+=)''\+/g,j=/(__e\(.*?\)|\b__t\))\+'';/g,k=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,E=/\w*$/,C=/<%=([\s\S]+?)%>/g,O=RegExp("^["+_+"]*0+(?=.$)"),S=/($^)/,x=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Error Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),T="[object Arguments]",B="[object Array]",F="[object Boolean]",P="[object Date]",U="[object Function]",N="[object Number]",M="[object Object]",R="[object RegExp]",I="[object String]",z={};z[U]=false,z[T]=z[B]=z[F]=z[P]=z[N]=z[M]=z[R]=z[I]=true;var q={leading:false,maxWait:0,trailing:false},J={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false},L={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},V=J[typeof window]&&window||this,Y=J[typeof exports]&&exports&&!exports.nodeType&&exports,$=J[typeof module]&&module&&!module.nodeType&&module,W=$&&$.exports===Y&&Y,H=J[typeof global]&&global;!H||H.global!==H&&H.window!==H||(V=H);var K=p();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(V._=K,define(function(){return K})):Y&&$?W?($.exports=K)._=K:Y._=K:V._=K;return K}.call(this);(function(e){"use strict";(function(t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){if(Object.keys(module.exports).length!==0){module.exports.p=module.exports.Dfd=t()}else{module.exports=t()}}else{e.p=t();if(typeof e._!=="undefined"){e._.Dfd=e.p}}})(function(){function t(e,t){for(var r in t){e[r]=t[r]}}function r(e){return!!(e&&Object.prototype.toString.call(e)==="[object Function]")}function n(e){return!!(e&&Object.prototype.toString.call(e)==="[object Object]")}function i(e){return!!(e&&Object.prototype.toString.call(e)==="[object Array]")}function o(e){if(typeof e!=="undefined"&&e!==null&&e.toString&&e.toString()==="[object Promise]"){return true}return false}function a(e){if(typeof e!=="undefined"&&e!==null&&e.toString&&e.toString()==="[object Deferred]"){return true}return false}var s=e.setTimeout;if(typeof process==="object"&&r(process.nextTick)){s=process.nextTick}function u(e,t,r){s(function n(){for(var n=0;n<r.length;n++){r[n].call(e,t)}},0)}function f(e){if(e&&!i(e)){e=[e]}return e}var l={mine:"mine"};var c=l;function p(e,t,n){return function(i){c=l;if(e&&r(e)){try{c=e.call(undefined,i)}catch(o){c=l;t.reject(o)}if(c!==l){if(n==="reject"){t.resolve(c)}else{t[n](c)}}}else{t[n](i)}}}function h(e,t){e.done(function(e){t.doResolve(e)});e.fail(function(e){t.doReject(e)});e.progress(function(e){t.doNotify(e)})}function d(e,t,r){switch(t){case"resolve":r.doResolve(e);break;case"reject":r.doReject(e);break;case"notify":r.doNotify(e);break}}function v(e,t){var r={failed:false,datasThen:undefined};try{r.datasThen=e.then}catch(n){r.datasThen=undefined;r.failed=true;t.doReject(n)}return r}function y(e,t,r){var n=false;try{var i=new m;i.done(function(e){r.doResolve(e)}).fail(function(e){r.doReject(e)}).progress(function(e){r.doProgress(e)});e.call(t,function(e){if(!n){n=true;i.resolve(e)}},function(e){if(!n){n=true;i.reject(e)}},function(e){i.notify(e)})}catch(o){if(!n){r.doReject(o)}}}function g(e,t,n){var i=v(e,n);if(!i.failed){if(r(i.datasThen)){y(i.datasThen,e,n)}else{d(e,t,n)}}}var m=function _(e){if(this.constructor!==_){throw new Error("You must create deferreds with the 'new' keyword")}this.internalState=0;this.internalWith=undefined;this.internalData=null;this.callbacks={done:[],fail:[],always:[],progress:[]};this._pro=null;if(e&&r(e)){e.call(this,this)}return this};var b=function(e,r){this.done=e.done.bind(e);this.fail=e.fail.bind(e);this.progress=e.progress.bind(e);this.always=e.always.bind(e);this.then=e.then.bind(e);this.finish=e.finish.bind(e);this.state=function(){return e.internalState};if(r&&n(r)){t(r,this);return r}return this};t(b.prototype,{toString:function(){return"[object Promise]"}});t(m.prototype,{toString:function(){return"[object Deferred]"},Promise:b,notify:function(e){if(this.internalState===0){this.internalData=e;u(this.internalWith,this.internalData,this.callbacks.progress)}return this},notifyWith:function(e,t){if(this.internalState===0){this.internalWith=e;this.internalData=t;u(this.internalWith,this.internalData,this.callbacks.progress)}return this},doNotify:function(e){this.internalData=e;u(this.internalWith,this.internalData,this.callbacks.progress)},reject:function(e){if(this.internalState===0){this.deNestSanitizeTheInsanityAndCall(e,"reject")}return this},rejectWith:function(e,t){if(this.internalState===0){this.internalWith=e;this.deNestSanitizeTheInsanityAndCall(t,"reject")}return this},doReject:function(e){this.internalData=e;this.internalState=2;u(this.internalWith,this.internalData,this.callbacks.fail.concat(this.callbacks.always))},resolve:function(e){if(this.internalState===0){this.deNestSanitizeTheInsanityAndCall(e,"resolve")}return this},resolveWith:function(e,t){if(this.internalState===0){this.internalWith=e;this.deNestSanitizeTheInsanityAndCall(t,"resolve")}return this},doResolve:function(e){this.internalData=e;this.internalState=1;u(this.internalWith,this.internalData,this.callbacks.done.concat(this.callbacks.always))},always:function(e){e=f(e);if(e.length>0){if(this.internalState!==0){u(this.internalWith,this.internalData,e)
}else{this.callbacks.always=this.callbacks.always.concat(e)}}return this.promise()},done:function(e){e=f(e);if(e.length>0){if(this.internalState===1){u(this.internalWith,this.internalData,e)}else{this.callbacks.done=this.callbacks.done.concat(e)}}return this.promise()},fail:function(e){e=f(e);if(e.length>0){if(this.internalState===2){u(this.internalWith,this.internalData,e)}else{this.callbacks.fail=this.callbacks.fail.concat(e)}}return this.promise()},progress:function(e){if(this.internalState===0){e=f(e);this.callbacks.progress=this.callbacks.progress.concat(e)}return this.promise()},deNestSanitizeTheInsanityAndCall:function(e,t){if(e===this.promise()){this.doReject(new TypeError("Promise Tried to Resolve with Self"))}else if(o(e)){h(e,this)}else if(n(e)||r(e)){g(e,t,this)}else{d(e,t,this)}},then:function(e,t,r){var n=new m;this.done(p(e,n,"resolve")).fail(p(t,n,"reject")).progress(p(r,n,"notify"));return n.promise()},finish:function(){this.callbacks.fail.concat(this.callbacks.always);this.callbacks.fail.push(function(e){s(function(){throw e},0)})},wrap:function(e){var t=new m;var i;if(o(e)||a(e)){h(e,t)}else if(n(e)||r(e)){g(e,"resolve",t)}else{t.resolve(e)}return t.promise()},when:function(){var e=Array.prototype.slice.call(arguments);var t=[];var r=new m;var n=0;var s=0;var u=[];e.forEach(function(e){if(i(e)){t=t.concat(e)}else{t.push(e)}});if(t.length===0){r.resolve(u)}t.forEach(function(e,i){if(o(e)||a(e)||!!e){if(!o(e)&&!a(e)){e=m.wrap(e)}e.done(function(e){n++;s++;u[i]=e;r.notify({index:i,action:"resolved",data:e,resolved:n,handled:s});if(n===t.length){r.resolve(u)}else if(s===t.length){r.reject(u)}}).fail(function(e){s++;u[i]=e;r.notify({index:i,action:"rejected",data:e,resolved:n,handled:s});if(n===t.length){r.resolve(u)}else if(s===t.length){r.reject(u)}}).progress(function(e){r.notify(e)})}else{s++;u[i]=e}});if(n===t.length){r.resolve(u)}else if(s===t.length){r.reject(u)}return r.promise()},promise:function(e){if(!this._pro){this._pro=new this.Promise(this,e)}return this._pro},state:function(){return this.internalState}});m.when=m.prototype.when;m.wrap=m.prototype.wrap;if(Object.freeze){Object.freeze(m.prototype)}return m})})(this);(function(){"use strict";var e=0;_.__i__=function(){return e++};_.textToDate=function(e,t){var r={start:null,stop:null,text:null};t=_.isDate(t)&&t||t&&new Date(t)||new Date;if(e==="default"){e="lastDays7"}if(e==="today"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),23,59,59,999))}else if(e==="yesterday"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-1,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-1,23,59,59,999))}else if(e.match(/^lastDays\d+$/)){var n=e.match(/^lastDays(\d+)$/);var i=n[1];r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-i,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),23,59,59,999))}else if(e==="thisWeek"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-t.getUTCDay(),0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),23,59,59,999))}else if(e==="thisMonth"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),0,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),23,59,59,999))}else if(e==="lastWeek"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-t.getUTCDay()-7,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-t.getUTCDay()-1,23,59,59,999))}else if(e==="lastMonth"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth()-1,1,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),0,23,59,59,999))}else if(e==="lastMonth3"){r.start=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth()-3,1,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),0,23,59,59,999))}else if(e==="lastYear"){r.start=new Date(Date.UTC(t.getUTCFullYear()-1,0,1,0,0));r.stop=new Date(Date.UTC(t.getUTCFullYear()-1,11,31,23,59,59,999))}r.start=r.start.getTime();r.stop=r.stop.getTime();r.text=e;return r};_.fileSystemError=function(e){var t="";switch(e.name){case"QUOTA_EXCEEDED_ERR":t="QUOTA_EXCEEDED_ERR";break;case"NOT_FOUND_ERR":t="NOT_FOUND_ERR";break;case"SECURITY_ERR":t="SECURITY_ERR";break;case"INVALID_MODIFICATION_ERR":t="INVALID_MODIFICATION_ERR";break;case"INVALID_STATE_ERR":t="INVALID_STATE_ERR";break;default:t="Unknown Error";break}console.log("Error: "+t);return};_.lockProperty=function(e,t){Object.defineProperty(e,t,{enumerable:true,configurable:false,writable:false});return};_.createProps=function(e,t){for(var r=0;r<t.length;r++){Object.defineProperty(e,t[r].name,t[r].attrs)}return};_.createProp=function(e,t){Object.defineProperty(e,t.name,t.attrs);return};_.updateProp=function(e,t){Object.defineProperty(e,t.name,t.attrs);return};_.parseVersion=function(e){var t=e.split(",");var r={};if(t.length>1){var n=t[0].charAt(0);var i=t[1].charAt(t[1].length-1);if(n=="["){r.gte=t[0].substring(1).trim()}else if(n=="("||n=="{"){r.gt=t[0].substring(1).trim()}if(i=="]"){r.lte=t[1].substring(0,t[1].length-1).trim()}else if(i==")"||i=="}"){r.lt=t[1].substring(0,t[1].length-1).trim()}}else{r.eq=t[0]}return r};_.sanitizeVersion=function(e){var t=0;var r=e.split(".");var n=3-r.length;for(var i=0;i<n;i++){r.push(0)}t+=parseInt(r[0],10)*1e6;t+=parseInt(r[1],10)*1e3;t+=parseInt(r[2],10);return t};_.versionMatch=function(e,t){var r=_.sanitizeVersion(e.eq);if(t.eq&&_.sanitizeVersion(t.eq)!=r)return false;if(t.gte&&_.sanitizeVersion(t.gte)>r)return false;if(t.gt&&_.sanitizeVersion(t.gt)>=r)return false;if(t.lte&&_.sanitizeVersion(t.lte)<r)return false;if(t.lt&&_.sanitizeVersion(t.lt)<=r)return false;return true};_.hash=function(e){if(_.isNormalObject(e)){e=JSON.stringify(e)}e=_.encode_utf8(e);var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var r=0,n=0,i=0;r=r^-1;for(var o=0,a=e.length;o<a;o++){i=(r^e.charCodeAt(o))&255;n="0x"+t.substr(i*9,8);r=r>>>8^n}return r^-1+4294967296};_.encode_utf8=function(e){return encodeURIComponent(escape(e))};_.decode_utf8=function(e){return unescape(decodeURIComponent(e))};_.queryStringEncode=function(e){var t=[];if(_.isNormalObject(e)){for(var r in e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]))}}return t.join("&")};_.queryStringDecode=function(e){e=e.replace(/^\?/,"");var t={};if(_.isString(e)){var r=e.split("&");for(var n=0;n<r.length;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}}return t};var t=new RegExp("("+"\\b([a-z][-a-z0-9+.]+://|www\\.)"+"[^\\s'\"<>()]+"+"|"+"\\b[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}\\b"+")","gi");var r=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;_.youtube_parser=function(e){var t=e.match(r);if(t&&t[1].length==11){return t[1]}else{return false}};var n=/http:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;_.vimeo_parser=function(e){var t=e.match(n);if(t){return t[2]}else{return false}};_.htmlLinkify=function(e){var r;var n="";var i=0;while(r=t.exec(e)){n+=e.substr(i,r.index-i);var o=r[0].replace(/\.*$/,"");var a=_.youtube_parser(o);var s=_.vimeo_parser(o);if(a){n+="<div class='video-container'><iframe id='ytplayer' type='text/html' src='http://www.youtube.com/embed/"+a+"?autoplay=0' frameborder='0' allowfullscreen></iframe></div>"}else if(s){n+="<div class='video-container'><iframe src='http://player.vimeo.com/video/"+s+"' frameborder='0' allowFullScreen></iframe></div>"}else if(o.indexOf("@")>0){n+='<a target="_blank" href="';n+="mailto:";n+=o+'">'+e.substr(r.index,o.length)+"</a>"}else if(o.indexOf(":/")<0){n+='<a target="_blank" href="';n+="http://";n+=o+'">'+e.substr(r.index,o.length)+"</a>"}else{n+='<a target="_blank" href="';n+=o+'">'+e.substr(r.index,o.length)+"</a>"}i=r.index+o.length}return n+e.substr(i)};_.getCurrentLocationRoute=function(){var e={route:window.location.pathname+window.location.hash,host:window.location.host,pathname:window.location.pathname,search:window.location.search,href:window.location.href,hash:window.location.hash};e.route=e.route.replace(/\/#\/|\/#|#/,"/");e.route=e.route.replace(/^\/|\/$/g,"");e.route=e.route.replace(/\//g,":");return e};_.getByteLength=function(e){if(e===null||e===undefined){return 0}var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)};_.getOption=function(e,t){if(!e||!t){return}if(e.options&&t in e.options&&e.options[t]!==undefined){return e.options[t]}else{return e[t]}};_.dirtyKeys=function(e,t,r,n){n=n||{};r=r||null;e=e||{};t=t||{};var i,o;var a={};var s;var u=0;var f=Object.keys(e);var l=Object.keys(t);if(r){i=r;o=r;for(var u=0;u<r.length;u++){if(f.indexOf(r[u])===-1||l.indexOf(r[u])===-1){return false}}}else{i=f;o=l}for(u=0;u<i.length;u++){a[i[u]]=a[i[u]]||{};a[i[u]].aVal=e[i[u]]}for(u=0;u<o.length;u++){a[o[u]]=a[o[u]]||{};a[o[u]].bVal=t[o[u]];if(typeof a[o[u]].aVal!=="undefined"&&_.isEqual(a[o[u]].aVal,a[o[u]].bVal,null,n)||typeof a[o[u]].aVal==="undefined"&&typeof a[o[u]].bVal==="undefined"){delete a[o[u]]}}s=Object.keys(a);for(u=0;u<s.length;u++){a[s[u]].diff=_.diffValues(a[s[u]].aVal,a[s[u]].bVal,n)}return a};_.diffValues=function(e,t,r){r=r||{arrayOrderMatters:false};var n,i;if(typeof e==="undefined"){n="undefined"}else{n=Object.prototype.toString.call(e)}if(typeof t==="undefined"){i="undefined"}else{i=Object.prototype.toString.call(t)}if(n!==i){return{from:{type:n,value:e},to:{type:i,value:t}}}else{switch(n){case"[object Object]":return{objectChange:_.dirtyKeys(e,t)};break;case"[object Array]":var o={removed:[],added:[],changed:[]};if(r.arrayOrderMatters){var a,s;var u=e.length;var f=t.length;while(a<u&&s<f){if(_.isEqual(e[a],t[s])){a++;s++}if(s<f&&a<u){o.changed.push({index:a,from:e[a],to:t[s],diff:_.diffValues(e[a],t[s],r)});s++;a++}else if(a<u&&s>=f){o.removed.push({index:a,from:e[a],to:null});a++}else if(s<f&&a>=u){o.added.push({index:a,from:null,to:t[s]});a++}}return o}else{var l=[];var c=[];var p,h,a=0,s=0;for(a=0;a<e.length;a++){p=false;for(s=0;s<t.length;s++){if(_.isEqual(e[a],t[s])){p=true;l.push(a);c.push(s);break}}if(!p){o.removed.push({index:null,from:e[a],to:null})}}for(s=0;s<t.length;s++){h=false;if(c.indexOf(s)>=0){continue}o.added.push({index:null,from:null,to:t[s]})}return o}break;default:return{from:{type:n,value:e},to:{type:i,value:t}};break}}};_.isDirtyEqual=function(e,t,r,n){r=r||null;n=n||{};var i,o,a,s;if(e===t||e==t){return true}a=Object.prototype.toString.call(e);s=Object.prototype.toString.call(t);if(a!==s){return false}switch(a){case"[object Object]":var u=Object.keys(e);var f=Object.keys(t);if(r){i=r;o=r;if(n.ignoreKeys!==true){for(var l=0;l<r.length;l++){if(u.indexOf(r[l])===-1||f.indexOf(r[l])===-1){return false}}}}else{i=u;o=f}if(i.length!==o.length){return false}if(r||_.isDirtyEqual(i,o,null,n)){for(var l=0;l<i.length;l++){if(!_.isDirtyEqual(e[i[l]],t[o[l]],null,n)){return false}}return true}else{return false}break;case"[object Array]":if(e.length!==t.length){return false}for(var l=0;l<e.length;l++){if(!_.isDirtyEqual(e[l],t[l],null,n)){return false}}return true;break;case"[object Function]":if(e.toString()!==t.toString()){return false}break;case"[object Number]":if(e!=t){return false}break;case"[object Date]":if(e.getTime()!=t.getTime()){return false}else{return true}break}return false};_.isNormalObject=function(e){return Boolean(e)&&Object.prototype.toString.call(e)==="[object Object]"};var i=/^[^:]+:.*[^:]$/;_.isUrn=function(e){return _.isString(e)&&i.exec(e)};_.isRegex=_.isRegExp;_.genericizeTargetSelectorQueryString=function(e){var t=[];if(e.globalSelectorString!=""&&e.globalSelectorString!=null&&e.globalSelectorString!=undefined){return e.globalSelectorString}t=o(e,t);t=t.join(" > ");e.globalSelectorString=t;return t};function o(e,t){if(e.tagName=="BODY"||e.tagName=="body"){t.unshift("body");return t}else{var r="#"+e.id;if(r!="#"){t.unshift(r);return t}var n="."+e.className.split(" ").join(".");if(n!=="."){var i=e.parentNode.children;var a=[];for(var s=0;s<i.length;s++){if(i[s].className.split(" ").join(".")==n){a.push(i[s])}}if(a.length>1){var u=Array.prototype.indexOf.call(a,e)+1;n=n+":nth-child("+u+")"}t.unshift(n);return o(e.parentNode,t)}var f=e.tagName;var i=e.parentNode.children;var a=[];for(var s=0;s<i.length;s++){if(i[s].tagName==f){a.push(i[s])}}if(a.length>1){var u=Array.prototype.indexOf.call(a,e)+1;f=f+":nth-child("+u+")"}t.unshift(f);return o(e.parentNode,t)}}_.whiteListDomEvent=function(e,t){t=t||e.currentTarget;var r={altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,button:e.button,charCode:e.charCode,keyCode:e.keyCode,which:e.which,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,layerX:e.layerX,layerY:e.layerY,webkitMovementX:e.webkitMovementX,movementX:e.movementX,webkitMovementY:e.webkitMovementY,movementY:e.movementY,timeStamp:e.timeStamp,type:e.type,target:_.genericizeTargetSelectorQueryString(e.target),currentTarget:_.genericizeTargetSelectorQueryString(t),clipboardData:e.clipboardData,targetValue:e.target.value,currentTargetValue:e.currentTarget.value};return r};_.preallocateXhrs=function(e){var t={dfds:{},pros:[]};for(var r=0;r<e.length;r++){t.dfds[e[r]]=new _.Dfd;t.pros.push(t.dfds[e[r]].promise())}return t};_.viewHelpers={roundAndPad:function(e,t,r,n){e=e||0;t=""+Math.pow(10,t);var i=(""+Math[n](e*t)/t).split(".");if(!i[1]){i[1]="";for(var o=0;o<r;o++){i[1]=i[1]+"0"}}else{for(var a=1;a<r-i[1].length;a++){i[1]=i[1]+"0"}}if(!i[1]){return i[0]}else{return i[0]+"."+i[1]}},isDate:_.isDate,roundThreeAndPad:function(e){var t=(""+Math.round(e*1e3)/1e3).split(".");if(!t[1]){t[1]="000"}else if(t[1].length===1){t[1]=""+t[1]+"00"}else if(t[1].length===2){t[1]=""+t[1]+"0"}return t[0]+"."+t[1]},canonicalizeMenu:function(e){var t=t||{};for(var r=0;r<e.length;r++){var n=e[r].data;var i={};var o={};for(var a in n){t[a]=t[a]||{children:n[a]["children"],"class":n[a]["class"],name:n[a]["name"],link:n[a]["link"],parentClass:n[a]["parentClass"]};if(Object.keys(t[a].children).length===0&&Object.keys(n[a].children).length===0){}else{if(Object.keys(n[a].children).length===0||Object.keys(t[a].children).length===0){o[a]=o[a]||0;o[a]++;i[a+" ("+o[a]+")"]=n[a]}else{t[a].children=_.viewHelpers.canonicalizeMenuChildren(t[a].children,n[a].children||{})}}}for(var a in i){t[a]=t[a]||{children:i[a]["children"],"class":i[a]["class"],name:i[a]["name"],link:i[a]["link"],parentClass:i[a]["parentClass"]};if(Object.keys(t[a].children).length===0&&Object.keys(i[a].children).length===0){}else{t[a].children=_.viewHelpers.canonicalizeMenuChildren(t[a].children,i[a].children||{})}}}return t},canonicalizeMenuChildren:function(e,t){if(!e&&!t){return{}}var r={};var n;for(n in e){r[n]=e[n];if(t[n]){r[n].children=_.viewHelpers.canonicalizeMenuChildren(e[n].children,t[n].children);r[n]["class"]=e[n]["class"]+" "+t[n]["class"];r[n]["name"]=e[n]["name"]+" "+t[n]["name"];r[n]["link"]=t[n]["link"]}}for(n in t){if(!r[n]){r[n]=t[n]}}return r},prettifyDate:function(e,t){if(t&&t.getTime){t=t.getTime()}else if(t){t=new Date(t).getTime()}else{t=(new Date).getTime()}if(e&&e.getTime){e=e.getTime()}else if(e){e=new Date(e).getTime()}else{e=(new Date).getTime()}var r=Math.abs(t-e);var n=r/(1e3*60*60*24);var i=n%1*24;var o=i%1*60;var a=o%1*60;n=Math.floor(n);i=Math.floor(i);o=Math.floor(o);a=Math.floor(a);if(n){n+="d ";i+="hr";return n+i}else if(i){i+="hr ";o+="m";return i+o}else if(o){if(o<10&&a>0){o+="m ";a+="s";return o+a}else{o+="m";return o}}else{a+="s";return a}},formatDate:function(e,t){var r="";if(!_.isDate(t)){t=new Date(t);if(!_.isDate(t)){t=new Date}}r=t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate();return r},formatTime:function(e,t,r){var n="";if(!_.isDate(t)){t=new Date(t);if(!_.isDate(t)){t=new Date}}var i=r===true?t.getUTCHours():t.getHours();var o=r===true?t.getUTCMinutes():t.getMinutes();var a;if(i>=12){i-=12;a="PM"}else{a="AM"}if(o<10){o="0"+o}n=i+":"+o+" "+a;return n},formatDuration:function(e,t){t=t||{};if(e==parseInt(e)){e=parseInt(e)}e=typeof e==="number"&&e>0?e:0;var r=60;var n=r*60;var i=n*24;var o="";if(t.days&&e/i>=1){var a=Math.floor(e/i);e-=a*i;if(a<=9){o+="0"}o+=a+":"}if(t.hours&&(e/n>=1||a)){var s=Math.floor(e/n);e-=s*n;if(s<=9){o+="0"}o+=s+":"}if(t.minutes!==false){var u=Math.floor(e/r);if(u>=1){e-=u*r}if(u<=9&&(t.days||t.hours)){o+="0"}o+=u+":"}var f=e||0;if(f<=9){o+="0"}o+=f;return o},escapeHtml:_.escape,escape:_.escape};return _})();(function(){"use strict";_.enableRetardMode=function(){if(!Object.keys){Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(i){if(typeof i!=="object"&&(typeof i!=="function"||i===null)){throw new TypeError("Object.keys called on non-object")}var o=[],a,s;for(a in i){if(e.call(i,a)){o.push(a)}}if(t){for(s=0;s<n;s++){if(e.call(i,r[s])){o.push(r[s])}}}return o}}()}if(!Object.create){Object.create=function(){function e(){}return function(t){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.")}e.prototype=t;return new e}}()}if(!Object.freeze){Object.freeze=function(e){return e};Object.isFrozen=function(){return false}}if(!Object.seal){Object.seal=function(e){return e};Object.isSealed=function(){return false}}if(!Object.preventExtensions){Object.preventExtensions=function(e){return e};Object.isExtensible=function(){return false}}if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),r=this,n=function(){},i=function(){return r.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};n.prototype=this.prototype;i.prototype=new n;return i}}if(!Array.prototype.forEach){Array.prototype.forEach=function e(t,r){"use strict";var n,i;if(this==null){throw new TypeError("this is null or not defined")}var o,a=Object(this),s=a.length>>>0;if({}.toString.call(t)!=="[object Function]"){throw new TypeError(t+" is not a function")}if(arguments.length>=2){n=r}i=0;while(i<s){if(i in a){o=a[i];t.call(n,o,i,a)}i++}}}if(!Array.prototype.map){Array.prototype.map=function(e,t){var r,n,i;if(this==null){throw new TypeError(" this is null or not defined")}var o=Object(this);var a=o.length>>>0;if(typeof e!=="function"){throw new TypeError(e+" is not a function")}if(t){r=t}n=new Array(a);i=0;while(i<a){var s,u;if(i in o){s=o[i];u=e.call(r,s,i,o);n[i]=u}i++}return n}}if(!Array.prototype.filter){Array.prototype.filter=function(e){"use strict";if(!this){throw new TypeError}var t=Object(this);var r=t.length>>>0;if(typeof e!=="function"){throw new TypeError}var n=[];var i=arguments[1];for(var o in t){if(t.hasOwnProperty(o)){if(e.call(i,t[o],o,t)){n.push(t[o])}}}return n}}if(!("every"in Array.prototype)){Array.prototype.every=function(e,t){for(var r=0,n=this.length;r<n;r++)if(r in this&&!e.call(t,this[r],r,this))return false;return true}}if(!("some"in Array.prototype)){Array.prototype.some=function(e,t){for(var r=0,n=this.length;r<n;r++)if(r in this&&e.call(t,this[r],r,this))return true;return false}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){"use strict";if(this==null){throw new TypeError}var t,r,n=Object(this),i=n.length>>>0;if(i===0){return-1}t=0;if(arguments.length>1){t=Number(arguments[1]);if(t!=t){t=0}else if(t!=0&&t!=Infinity&&t!=-Infinity){t=(t>0||-1)*Math.floor(Math.abs(t))}}if(t>=i){return-1}for(r=t>=0?t:Math.max(i-Math.abs(t),0);r<i;r++){if(r in n&&n[r]===e){return r}}return-1}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(typeof Array.prototype.lastIndexOf==="undefined"){Array.prototype.lastIndexOf=function(e,t){if(t===undefined)t=this.length-1;if(t<0)t+=this.length;if(t>this.length-1)t=this.length-1;for(t++;t-->0;)if(t in this&&this[t]===e)return t;return-1}}}})();(function(e,t){"use strict";var r=1;var n;var i=[];var o=[];var a=0;e.setImmediateDebug=function(){return{nextHandle:r,freeHandle:n,cbsByHandle:i,argsByHandle:o,howMany:a}};var s;function u(e,a){s=n!==t?n:r++;i[s]=e;o[s]=a;n=t;return s}function f(e){e=parseInt(e,10);i[e]?i[e].apply(t,o[e]):false;n=e;a++}function l(){return typeof process==="object"&&Object.prototype.toString.call(process)==="[object process]"}function c(){if(!e.postMessage||e.importScripts){return false}var t=true;var r=e.onmessage;e.onmessage=function(){t=false};e.postMessage("","*");e.onmessage=r;return t}function p(){return!!e.MessageChannel}function h(e){e.setImmediate=function(){var e=arguments;process.nextTick(function(){e[0].call(t,Array.prototype.slice.call(e,1))})}}function d(t){var r="com.setImmediate"+Math.random();var n=r.length;function i(e){return typeof e==="string"&&e.substring(0,n)===r}function o(t){if(t.source===e&&i(t.data)){f(t.data.substring(n))}}if(e.addEventListener){e.addEventListener("message",o,false)}else{e.attachEvent("onmessage",o)}t.setImmediate=function(){var t=arguments[0];var n=Array.prototype.slice.call(arguments,1);e.postMessage(r+u(t,n),"*")}}function v(t){var r=new e.MessageChannel;r.port1.onmessage=function(e){f(e.data)};t.setImmediate=function(){var e=arguments[0];var t=Array.prototype.slice.call(arguments,1);r.port2.postMessage(u(e,t))}}function y(r){r.setImmediate=function(){var r=arguments[0];var n=Array.prototype.slice.call(arguments,1);e.setTimeout(function(){r.call(t,n)},0)}}if(!e.setImmediate){var g=typeof Object.getPrototypeOf==="function"&&"setTimeout"in Object.getPrototypeOf(e)?Object.getPrototypeOf(e):e;if(l()){h(g)}else if(c()){d(g)}else if(p()){v(g)}else{y(g)}}})(typeof self==="object"&&self?self:this);(function(){"use strict";e.prototype=Object.create(Object.prototype);e.prototype.get=function(e){return this.find(e)};e.prototype.has=function(e){if(this.find(e)){return true}return false};e.prototype.toString=function(){return"[object Set]"};if(Object.defineProperties){Object.defineProperty(e.prototype,"get",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"has",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"toString",{enumerable:false,writable:false})}function e(e){var t=[];if(e!==null&&e!=undefined&&typeof e!=="undefined")t=e;this.add=function(e){if(this.find(e)===undefined)t.push(e)};this["delete"]=function(e){var r=0;for(r;r<t.length;r++){if(t[r]===e){t.splice(r,1);break}}};this.size=function(){return t.length};this.find=function(e){var r=undefined;for(var n=0;n<t.length;n++){if(t[n]===e){r=t[n];break}}return r};this.toJSON=function(){return t};if(Object.defineProperties){Object.defineProperty(this,"add",{enumerable:false,writable:false});Object.defineProperty(this,"delete",{enumerable:false,writable:false});Object.defineProperty(this,"size",{enumerable:false,writable:false});Object.defineProperty(this,"toJSON",{enumerable:false,writable:false})}return this}_.Set=e})();(function(){"use strict";e.prototype=Object.create(Object.prototype);e.prototype.get=function(e){var t=this.find(e);if(t){return t.val}return null};e.prototype.has=function(e){if(this.find(e)){return true}return false};e.prototype.toString=function(){return"[object Map]"};if(Object.defineProperties){Object.defineProperty(e.prototype,"get",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"has",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"toString",{enumerable:false,writable:false})}function e(e){var t=[];this.find=function(e){var r=undefined;for(var n=0;n<t.length;n++){if(t[n].key===e){r=t[n];break}}return r};this.size=function(){return t.length};this.set=function(e,r){var n=this.find(e);if(n!=undefined){n.val=r}else{t.push({key:e,val:r})}return};this["delete"]=function(e){var r=0;for(r;r<t.length;r++){if(t[r].key===e){t.splice(r,1);break}}};this.toJSON=function(){return t};if(Object.defineProperties){Object.defineProperty(this,"find",{enumerable:false,writable:false});Object.defineProperty(this,"size",{enumerable:false,writable:false});Object.defineProperty(this,"set",{enumerable:false,writable:false});Object.defineProperty(this,"delete",{enumerable:false,writable:false});Object.defineProperty(this,"toJSON",{enumerable:false,writable:false})}if(!_.isArray(e)){e=_.pairs(e)}for(var r=0;r<e.length;r++){var n=e[r];if(_.isArray(n)){this.set(n[0],n[1])}else{for(var i in n){this.set(i,n[i])}}}return this}_.Map=e})();(function(){"use strict";e.prototype=Object.create(Object.prototype);e.prototype.get=function(e){var t=this.find(e);if(t)return t.val};e.prototype.has=function(e){if(this.find(e))return true;else return false};e.prototype.toString=function(){return"[object WeakMap]"};if(Object.defineProperties){Object.defineProperty(e.prototype,"get",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"has",{enumerable:false,writable:false});Object.defineProperty(e.prototype,"toString",{enumerable:false,writable:false})}function e(e){var t=[];var r=this;r.explanation="This is a Shim polyfil for the concept of a ES6.WeakMap.";r.find=function(e){var r=undefined;for(var n=0;n<t.length;n++){if(t[n].key===e){r=t[n];break}}return r};r.size=function(){return t.length};r.set=function(e,r){var n=this.find(e);if(n!=undefined){n.val=r}else{t.push({key:e,val:r})}return};r["delete"]=function(e){var r=0;for(r;r<t.length;r++){if(t[r].key===e);break}t.splice(r,1)};r.toJSON=function(){return t};if(Object.defineProperties){Object.defineProperty(r,"find",{enumerable:false,writable:false});Object.defineProperty(r,"size",{enumerable:false,writable:false});Object.defineProperty(r,"set",{enumerable:false,writable:false});Object.defineProperty(r,"delete",{enumerable:false,writable:false});Object.defineProperty(r,"toJSON",{enumerable:false,writable:false})}if(!_.isArray(e))e=_.pairs(e);for(var n=0;n<e.length;n++){var i=e[n];if(_.isArray(i)){this.set(i[0],i[1])}else{for(var o in i){this.set(o,i[o])}}}return r}_.WeakMap=e})();(function(){"use strict";e.prototype=Object.create(Array.prototype);e.prototype.toString=function(){return"[object Capped]"};if(Object.defineProperties){Object.defineProperty(e.prototype,"toString",{enumerable:false,writable:false})}function e(e,t){e=e||{};_.defaults(e,{size:1e3,rotate:true});var r=this;r.push=function(){var t=Array.prototype.slice.call(arguments,0);if(e.rotate===true){Array.prototype.push.apply(this,t);var r=this.length-e.size;if(r>0){Array.prototype.splice.call(this,0,r)}}else{var n=this;var i=e.size-this.length;var o=t.splice(0,i);Array.prototype.push.apply(n,o)}return this.length};r.unshift=function(){var t=Array.prototype.slice.call(arguments,0);if(e.rotate===true){Array.prototype.unshift.apply(this,t);var r=this.length-e.size;if(r>0){Array.prototype.splice.call(this,-r,r)}}else{var n=this;var i=e.size-this.length;var o=t.splice(0,i);Array.prototype.unshift.apply(n,o)}return this.length};r.splice=function(){var t=Array.prototype.slice.call(arguments,0);var r=t.shift();var n=t.shift();var i=t;var o=Array.prototype.splice.call(this,r,n);if(e.rotate===true){i.unshift(0);i.unshift(r);Array.prototype.splice.apply(this,i);var a=this.length-e.size;if(a>0){Array.prototype.splice.call(this,-a,a)}}else{var s=this;var u=e.size-this.length;var f=i.splice(0,u);f.unshift(0);f.unshift(r);Array.prototype.splice.apply(this,f)}return o};if(Object.defineProperties){Object.defineProperty(r,"push",{enumerable:false,writable:false,configurable:false})}if(Object.defineProperties){Object.defineProperty(r,"unshift",{enumerable:false,writable:false,configurable:false})}if(Object.defineProperties){Object.defineProperty(r,"splice",{enumerable:false,writable:false,configurable:false})}if(t){for(var n=0;n<t.length;n++){r.push(t[n])}}return r}_.Capped=e})();(function(){"use strict";function e(e,t){for(var r in t){e[r]=t[r]}return e}function t(e,t,r){r=r||[];for(var n=0;n<r.length;n++){setTimeout(function(n){r[n].call(e,t)},0,n)}}function r(e){if(e&&{}.toString.call(e)!=="[object Array]"){e=[e]}return e}var n=function(e){var r=this;e=e||{initState:"new",states:["new"]};e.sync=e.sync||false;this.data=null;this.internalState=e.initState;this.states=[];this.callbacks={all:{enter:[],leave:[],on:[],notify:[]}};this.addStates(e.states);this.trigger=function(e,n){t(r,e,n)};if(Object.defineProperties){Object.defineProperties(this,{internalState:{enumerable:false,writable:true,configurable:false},states:{enumerable:false,writable:false,configurable:false},callbacks:{enumerable:false,writable:false,configurable:false}})}if(Object.seal){Object.seal(this)}if(Object.freeze){Object.freeze(n.prototype)}return this};e(n.prototype,{toString:function(){return"[object StateMachine]"},Promise:function(e,t){this.toString=function(){return"[object StatePromise]"};this.on=e.done.bind(e);this.state=e.state.bind(e);this.getStates=e.getStates.bind(e);return this},on:function(e,t,n){n=n||"on";t=r(t);if(t.length>0){var i=this.state();this.callbacks[e][n]=this.callbacks[e][n].concat(t)}return},go:function(e,t){t=t||{};this.data=t;if(e!=this.state()){var r={leavingState:this.state(),enteringState:e,data:t};var n=[];n=n.concat(this.callbacks.all.leave).concat(this.callbacks[this.state()].leave);this.trigger(r,n);n=[];n=n.concat(this.callbacks.all.enter).concat(this.callbacks[e].enter);this.trigger(r,n);this.setState(e);n=[];n=n.concat(this.callbacks.all.on).concat(this.callbacks[e].on);this.trigger(r,n)}else{var n=[];var r={leavingState:e,enteringState:e,data:t};n=n.concat(this.callbacks.all.notify).concat(this.callbacks[e].notify);this.trigger(r,n)}return},addStates:function(e){if(!(e&&{}.toString.call(e)==="[object Array]")){e=[e]
}e.forEach(function(e){this.states.push(e);this.callbacks[e]=this.callbacks[e]||{enter:[],leave:[],on:[],notify:[]}},this)},removeStates:function(e){if(!(e&&{}.toString.call(e)==="[object Array]")){e=[e]}var t=[];for(var r=0;r<this.states.length;r++){if(this.states[r]in e){t.push(r);delete this.callbacks[this.states[r]]}}t.forEach(function(e){this.states.splice(e,1)},this)},getStates:function(){return this.states},state:function(){return this.internalState},setState:function(e){if(this.states.indexOf(e)>-1){this.internalState=e}return this.state()},promise:function(){var e=new this.Promise(this);return e}});_.State=n;return n})();(function(e){var t=function(e,t){var r=[];return function(){for(var n=0;n<arguments.length;++n)r.push(arguments[n]);e-=1;if(e==0)t.apply(this,r)}};var r=function(){function r(e,t){return function(r){if(r.code==1){e.resolve(undefined)}else{if(t)t.reject(r);else e.reject(r)}}}function n(e,t){var r=new _.Dfd;i(e,t,r);return r.promise()}function i(e,t,r){e.readEntries(function(n){if(n.length==0){r.resolve(t)}else{t=t.concat(n);i(e,t,r)}},function(e){r.reject(e)})}function o(e,t,r){e.file(t,r)}function a(e,t,r){this._fs=e;this._capacity=t;this._prefix=r;this.type="FilesystemAPI"}a.prototype={get:function(e,t){var n=new _.Dfd;e=this._prefix+e;this._fs.root.getFile(e,{},function(i){i.file(function(r){var i=new FileReader;i.onloadend=function(r){var i=r.target.result;var o;if(i!==null&&typeof i!=="undefined"&&t&&t.json){try{i=JSON.parse(i)}catch(r){o=new Error("unable to parse JSON for "+e)}}if(o){n.reject(o)}else{n.resolve(i)}};i.readAsText(r)},r(n))},r(n));return n.promise()},set:function(e,t,n){var i=new _.Dfd;if(n&&n.json){t=JSON.stringify(t)}e=this._prefix+e;this._fs.root.getFile(e,{create:true},function(e){e.createWriter(function(e){var n;e.onwriteend=function(t){e.onwriteend=function(){i.resolve()};e.truncate(n.size)};e.onerror=r(i);n=new Blob([t],{type:"application/json"});e.write(n)},r(i))},r(i));return i.promise()},list:function(e){e=e||{};var t=new _.Dfd;this._fs.root.getDirectory(this._prefix,{create:false},function(r){var i=r.createReader();n(i,[]).then(function(r){var n=[];r.forEach(function(t){if(!t.isDirectory){if(e.prefix){if(t.name.indexOf(e.prefix)===0){n.push(t.name)}}else{n.push(t.name)}}});t.resolve(n)})},function(e){t.reject(e)});return t.promise()},clear:function(e){e=e||{};var r=new _.Dfd;var n=false;var i=function(e){n=true;r.reject(e)};this._fs.root.getDirectory(this._prefix,{},function(o){var a=o.createReader();a.readEntries(function(o){var a=t(o.length,function(){if(!n){r.resolve()}});o.forEach(function(t){if(t.isDirectory){t.removeRecursively(a,i)}else{if(e.prefix){if(t.name.indexOf(e.prefix)===0){t.remove(a,i)}}else{t.remove(a,i)}}});if(o.length==0)r.resolve()},i)},i);return r.promise()},remove:function(e){var t=new _.Dfd;var n=new _.Dfd;e=this._prefix+e;this._fs.root.getFile(e,{create:false},function(e){e.remove(function(){t.done(n.resolve)},function(e){n.reject(e)})},r(n));return n.promise()},getCapacity:function(){return this._capacity}};return{init:function(t){var r=new _.Dfd;e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var n=navigator.persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage;var i=navigator.temporaryStorage=navigator.temporaryStorage||navigator.webkitTemporaryStorage;e.resolveLocalFileSystemURL=e.resolveLocalFileSystemURL||e.webkitResolveLocalFileSystemURL;if(!requestFileSystem){r.reject("No FSAPI");return r.promise()}var o=t.name+"/";n.requestQuota(t.size,function(e){requestFileSystem(PERSISTENT,e,function(n){n.root.getDirectory(t.name,{create:true},function(){r.resolve(new a(n,e,o))},function(e){r.reject(e)})},function(e){r.reject(e)})},function(e){r.reject(e)});return r.promise()}}}();var n=function(){var t=e.URL||e.webkitURL;function r(e){this._db=e;this.type="IndexedDB";this._supportsBlobs=false}r.prototype={get:function(e,t){var r=new _.Dfd;var n=this._db.transaction(["files"],"readonly");var i=n.objectStore("files").get(e);i.onsuccess=function(e){var n=e.target.result;if(n!==null&&typeof n!=="undefined"&&t&&t.json){n=JSON.parse(n)}r.resolve(n)};i.onerror=function(e){r.reject(e)};return r.promise()},set:function(e,t,r){var n=new _.Dfd;var i=this._db.transaction(["files"],"readwrite");if(r&&r.json){t=JSON.stringify(t)}var o=i.objectStore("files").put(t,e);o.onsuccess=function(e){n.resolve(e.target.result)};o.onerror=function(e){n.reject(e)};return n.promise()},remove:function(e){var t=new _.Dfd;var r=this._db.transaction(["files"],"readwrite");var n=r.objectStore("files")["delete"](e);put.onsuccess=function(e){t.resolve(e.target.result)};n.onerror=function(e){t.reject(e)};return t.promise()},list:function(e){e=e||{};var t=new _.Dfd;var r=this._db.transaction(["files"],"readonly");var n=r.objectStore(store).openCursor();var i=[];n.onsuccess=function(r){var n=r.target.result;if(n){if(e.prefix){if(n.key.indexOf(e.prefix)===0){i.push(n.key)}}else{i.push(n.key)}i.push(n.key);n.continue()}else{t.resolve(i)}};n.onerror=function(e){t.reject(e)};return t.promise()},clear:function(e){e=e||{};var t=new _.Dfd;var r=this._db.transaction(["files"],"readwrite");if(!e.prefix){var n=r.objectStore("files").clear();n.onsuccess=function(e){t.resolve(e.target.result)};n.onerror=function(e){t.reject(e)}}else{var i=this;this.list(e).done(function(e){var r=[true];e.forEach(function(e){r.push(i.remove(e))});_.Dfd.when(r).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})}).fail(function(e){t.reject(e)})}return t.promise()}};return{init:function(t){var n=new _.Dfd;var i=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB,o=e.IDBTransaction||e.webkitIDBTransaction||e.OIDBTransaction||e.msIDBTransaction,a=2;if(!i||!o){n.reject("No IndexedDB");return n.promise()}var s=i.open(t.name,a);function u(e){e.createObjectStore("files")}s.onerror=function(e){n.reject(e)};s.onsuccess=function(e){var t=s.result;t.onerror=function(e){console.log(e)};if(t.setVersion){if(t.version!=a){var i=t.setVersion(a);i.onsuccess=function(){u(t);n.resolve()}}else{n.resolve(new r(t))}}else{n.resolve(new r(t))}};s.onupgradeneeded=function(e){u(e.target.result)};return n.promise()}}}();var i=function(){var t=e.URL||e.webkitURL;function r(e){this._db=e;this.type="WebSQL"}r.prototype={get:function(e,t){var r=new _.Dfd;this._db.transaction(function(n){n.executeSql("SELECT value FROM files WHERE fname = ?",[e],function(e,n){if(n.rows.length==0){r.resolve(undefined)}else{var i=n.rows.item(0).value;if(i!==null&&typeof i!=="undefined"&&t&&t.json){i=JSON.parse(i)}r.resolve(i)}})},function(e){r.reject(e)});return r.promise()},set:function(e,t,r){var n=new _.Dfd;if(r&&r.json){t=JSON.stringify(t)}this._db.transaction(function(r){r.executeSql("INSERT OR REPLACE INTO files (fname, value) VALUES(?, ?)",[e,t])},function(e){n.reject(e)},function(){n.resolve()});return n.promise()},remove:function(e){var t=new _.Dfd;this._db.transaction(function(t){t.executeSql("DELETE FROM files WHERE fname = ?",[e])},function(e){t.reject(e)},function(){t.resolve()});return t.promise()},list:function(e){e=e||{};var t=new _.Dfd;var r="SELECT fname FROM files";var n=[];if(e.prefix){r+=" WHERE fname LIKE ?";n=[e.prefix+"%"]}this._db.transaction(function(e){e.executeSql(r,n,function(e,r){var n=[];for(var i=0;i<r.rows.length;++i){n.push(r.rows.item(i)["fname"])}t.resolve(n)},function(e){t.reject(e)})});return t.promise()},clear:function(e){e=e||{};var t=new _.Dfd;var r="DELETE FROM files";var n=[];if(e.prefix){r+=" WHERE fname LIKE ?";n=[e.prefix+"%"]}this._db.transaction(function(e){e.executeSql(r,n,function(){t.resolve()})},function(e){t.reject(e)});return t.promise()}};return{init:function(t){var n=e.openDatabase;var i=new _.Dfd;if(!n){i.reject("No WebSQL");return i.promise()}var o=n(t.name,"1.0","large local storage",t.size);o.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS files (fname unique, value)")},function(e){i.reject(e)},function(){i.resolve(new r(o))});return i.promise()}}}();var o=function(){function t(e){if(!e.type){e.type="LocalStorage"}this.type=e.type;if(this.type==="SessionStorage"){this.store=sessionStorage}else{this.store=localStorage}this._prefix=e.name+":"}t.prototype={get:function(e,t){var r=new _.Dfd;var n=this.store.getItem(this._prefix+e);if(n!==null&&typeof n!=="undefined"&&t&&t.json){n=JSON.parse(n)}r.resolve(n);return r.promise()},set:function(e,t,r){var n=new _.Dfd;if(r&&r.json){t=JSON.stringify(t)}this.store.setItem(this._prefix+e,t);n.resolve();return n.promise()},remove:function(e,t){var r=new _.Dfd;this.store.removeItem(this._prefix+e);r.resolve();return r.promise()},list:function(e){e=e||{};var t=this;var r=new _.Dfd;var n=Object.keys(this.store);var i=[];var o=this._prefix;if(e.prefix){o+=e.prefix}n.forEach(function(e){if(e.indexOf(o)===0){i.push(e.substr(t._prefix.length-1))}});r.resolve(i);return r.promise()},clear:function(e){e=e||{};var t=this;var r=new _.Dfd;var n=Object.keys(this.store);var i=this._prefix;if(e.prefix){i+=e.prefix}n.forEach(function(e){if(e.indexOf(i)===0){t.store.removeItem(e)}});r.resolve();return r.promise()}};return{init:function(r){var n=new _.Dfd;if(this.type==="SessionStorage"&&!e.sessionStorage){n.resolve(new t(r))}else if(this.type==="LocalStorage"&&!e.localStorage){n.resolve(new t(r))}else{n.reject()}return n.promise()}}}();var a=function(){function e(e){this.store=chrome.storage.local;this._prefix=e.name+":"}e.prototype={get:function(e,t){var r=new _.Dfd;var n=this.store.get(this._prefix+e,function(e){if(chrome.runtime.lastError){r.reject(chrome.runtime.lastError)}else{if(e!==null&&typeof e!=="undefined"&&t&&t.json){e=JSON.parse(e)}r.resolve(e)}});return r.promise()},set:function(e,t,r){var n=new _.Dfd;if(r&&r.json){t=JSON.stringify(t)}var i={};i[this._prefix+e]=t;this.store.set(i,function(){if(chrome.runtime.lastError){n.reject(chrome.runtime.lastError)}else{n.resolve()}});return n.promise()},remove:function(e,t){var r=new _.Dfd;this.store.remove(this._prefix+e,function(){if(chrome.runtime.lastError){r.reject(chrome.runtime.lastError)}else{r.resolve()}});return r.promise()},list:function(e){e=e||{};var t=this;var r=new _.Dfd;var n=this._prefix;if(e.prefix){n+=e.prefix}this.store.get(null,function(e){var i=[];if(chrome.runtime.lastError){r.reject(chrome.runtime.lastError)}else{for(var o in items){if(o.indexOf(n)===0){i.push(o.substr(t._prefix.length-1))}}r.resolve(i)}});return r.promise()},clear:function(e){e=e||{};var t=this;var r=new _.Dfd;var n=[true];var i=this._prefix;if(e.prefix){i+=e.prefix}this.store.get(null,function(e){var t=[];if(chrome.runtime.lastError){r.reject(chrome.runtime.lastError)}else{function i(e){var t=new _.Dfd;n.push(t.promise());this.store.remove(e,function(){if(chrome.runtime.lastError){t.reject(chrome.runtime.lastError)}else{t.resolve()}})}for(var o in items){i(o)}r.resolve(t)}});_.Dfd.when(n).done(function(e){e.shift();r.resolve(e)}).fail(function(e){e.shift();r.resolve(e)});return r.promise()}};return{init:function(t){var r=new _.Dfd;if(typeof chrome==="object"&&chrome.storage&&chrome.storage.local){r.resolve(new e(t))}else{r.reject()}return r.promise()}}}();var s=function(){var e={FileSystemAPI:r,IndexedDB:n,WebSQL:i,LocalStorage:o,SessionStorage:o,ChromeStorageProvider:a};var t={size:10*1024*1024,name:"lls"};function s(s){if(!s)s={};for(var u in t){s[u]=s[u]||t[u]}if(s.forceProvider){return e[s.forceProvider].init(s)}var f=new _.Dfd;a.init(s).done(function(e){f.resolve(e)}).fail(function(){o.init(s).done(function(e){f.resolve(e)}).fail(function(){n.init(s).done(function(e){f.resolve(e)}).fail(function(){r.init(s).done(function(e){f.resolve(e)}).fail(function(){i.init(s).done(function(e){f.resolve(e)}).fail(function(){f.reject("I have nothing.... leave me alone :(")})})})})});return f.promise()}function u(e){var t=this;var r=new _.Dfd;s(e).done(function(e){t._impl=e;r.resolve(t)}).fail(function(e){r.reject("No storage provider found")});t.initialized=r.promise();return t}u.prototype={ready:function(){return this.initialized},list:function(e){this._checkAvailability();return this._impl.list(e)},remove:function(e){this._checkAvailability();return this._impl.remove(e)},clear:function(){this._checkAvailability();return this._impl.clear()},get:function(e,t){this._checkAvailability();return this._impl.get(e,t)},set:function(e,t,r){this._checkAvailability();return this._impl.set(e,t,r)},getCapacity:function(){this._checkAvailability();if(this._impl.getCapacity)return this._impl.getCapacity();else return-1},_checkAvailability:function(){if(!this._impl){throw{msg:"No storage implementation is available yet.  The user most likely has not granted you app access to FileSystemAPI or IndexedDB",code:"NO_IMPLEMENTATION"}}}};return u}();e._=e._||{};e._.LargeLocalStorage=s;return s})(typeof self!=="undefined"?self:this);(function(){"use strict";var e={};var t={};var r=function(e){if(!e.match(/\:[*#]$/)){return true}else{return false}};var n=function N(t){for(var r in e){if(e[r].regex.exec(t)){return e[r].Model}}};var i=function M(e){for(var r in t){if(t[r].regex.exec(e)){return t[r].collection}}};var o={};var a=function R(e,t){if(o[e]){return o[e]}else{if(!t){for(var r in o){if(_.isRegex(o[r].regex)&&o[r].regex.exec(e)){return o[r]}}}}};var s=function I(e,t,r,n,i){var o=new t(e);if(!i){o.get().done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}else{r.insert({entry:o});n.resolve(o)}};var u=function z(e,t){var r=new _.Dfd;var o=i(e.urn);var u=n(e.urn);var f;if(o){f=o.queryOne({filter:{urn:e.urn}});if(typeof f!=="undefined"){r.resolve(f)}else{var l=a(e.urn);if(l){l.promise.done(function c(){setTimeout(function(){f=o.queryOne({filter:{urn:e.urn}});if(f){r.resolve(f)}else{var n=a(e.urn,true);if(n){n.promise.done(function(){f=o.queryOne({filter:{urn:e.urn}});if(f){r.resolve(f)}else{s(e,u,o,r,t)}})}else{console.error("Our alreadyWaiting promise finished, but we still couldn't find it. WTF?",e.urn,t,o);s(e,u,o,r,t)}}},5)})}else{s(e,u,o,r,t)}}}else if(u){s(e,u,r,t)}else{r.reject("Couldn't find a Model registered for "+e.urn)}return r.promise()};var f=function q(e,t){t=t||{};var r=new _.Dfd;var n=[true];function i(t){var r=e._options.refs[t];if(_.isArray(r)){e[t].forEach(function(r,i){var o;if(_.isNormalObject(r)&&_.isUrn(r.urn)&&!(r instanceof w)){o=new _.Dfd;u(r,true).done(function(r){e[t][i]=r;o.resolve()});n.push(o.promise())}else if(_.isUrn(r)){o=new _.Dfd;u({urn:r}).done(function(r){e[t][i]=r;o.resolve()});n.push(o.promise())}})}else{var i;if(_.isNormalObject(e[t])&&_.isUrn(e[t].urn)&&!(e[t]instanceof w)){i=new _.Dfd;u(e[t],true).done(function(r){e[t]=r;i.resolve()});n.push(i)}else if(_.isUrn(e[t])){i=new _.Dfd;u({urn:e[t]}).done(function(r){e[t]=r;i.resolve()});n.push(i.promise())}}}for(var o in e._options.refs){i(o)}_.Dfd.when(n).done(function(){r.resolve(e)}).fail(function(e){console.error("Errors in populates",e)});return r.promise()};var l=function J(e,r){var n=new _.Dfd;r=r||this;e.data=e.data||{};if(typeof e.remote==="undefined"){e.remote=true}e.method=e.method.toUpperCase();if(r._options.collection===true){e.urn=e.urn||r._options.urn}if(typeof e==="undefined"||!e.method||!e.urn){n.reject("Must Supply args object with method, url, and data");return n.promise()}if(r._options.store.remote&&e.remote){if(e.method==="GET"&&r._options.store.localStorage&&(r._options._ttl&&(new Date).getTime()>r._options._ttl)){if(e.method==="GET"){o[r.urn]=o[r.urn]||{promise:n.promise()}}c(e,r).done(function(e){n.resolve({data:e,headers:{},status:200,local:true})}).fail(function(e){n.reject(e)})}else{if(e.method==="GET"&&r._options.collection===true){o[r._options.urn]={promise:n.promise(),regex:t[r._options.name].regex}}d(e,r).done(function(t){if(e.method==="DELETE"){var a=i(r.urn);if(a){for(var s=0;s<a.entries.length;s++){if(a.entries[s].urn===r.urn){a.entries.splice(s,1)}}}}if(e.method==="POST"){var u=new _.Dfd;o[t.data.urn]=o[t.data.urn]||{promise:u.promise(),dfd:u};o[t.data.urn].promise.done(function(e){if(e){t.model=t.instance=e}else{var r=i(t.data.urn);if(r){t.model=t.instance=r.queryOne({filter:{urn:t.data.urn}})}}n.resolve(t)})}else{n.resolve(t)}}).fail(function(e){n.reject(e)})}}else if(r._options.store.localStorage){if(e.method==="GET"){o[r.urn]=o[r.urn]||{promise:n.promise()}}c(e,r).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}else{n.resolve(e.data)}return n.promise()};var c=function L(e,t){var r=e.urn;var n;var i;if(t._options.collection===true){var o=t._options.store.localStorage.split(":");o.splice(-1);r=o.join(":")}switch(e.method){case"GET":return self.Jive.Store.get(r,{json:true});break;case"POST":return self.Jive.Store.set(r,e.data,{json:true});break;case"PUT":return self.Jive.Store.set(r,e.data,{json:true});break;case"PATCH":n=new _.Dfd;i=self.Jive.Store.get(r,{json:true});i.done(function(t){_.extend(t,e.data);self.Jive.Store.set(r,t,{json:true}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}).fail(function(e){n.reject(e)});return n.promise();break;case"DELETE":return self.Jive.Store.remove(r);break;case"HEAD":n=new _.Dfd;i=self.Jive.Store.get(r,{json:true});i.done(function(e){n.resolve({lastModified:e.lastModified,eTag:e.eTag,ttl:e.ttl,expires:e.expires})}).fail(function(e){n.reject(e)});return n.promise();break;case"OPTIONS":default:n=new _.Dfd;n.resolve();return n.promise();break}};var p=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;var h=function(e){var t={};var r;while(r=p.exec(e)){t[r[1].toLowerCase()]=r[2]}return t};var d=function V(e,t){t=t||this;var r=new _.Dfd;var n=e.data||{};var i=e.data.urn||e.urn;if((e.method=="POST"||e.method=="PUT"||e.method=="PATCH")&&e.data){n=JSON.stringify(n)}else if((e.method=="GET"||e.method=="DELETE")&&e.data){i+="?"+$.param(n);n=JSON.stringify(n)}var o=t._options.store.remote.replace(/\/$/g,"");var a=new XMLHttpRequest;a.open(e.method,(self.Jive.Features.APIBaseUrl||"")+o+"/"+i);a.setRequestHeader("Content-Type","application/json; charset=utf-8");a.onreadystatechange=function s(){if(a.readyState===4){if(a.status>400){r.reject({e:a.status,status:a.status,headers:h(a&&a.getAllResponseHeaders()||"")})}else{var e=JSON.parse(a.responseText);r.resolve({data:e,status:a.status,headers:h(a&&a.getAllResponseHeaders()||"")})}}};a.send(n);return r.promise()};var v=function Y(e,t){t=t||this;e=e||{};if(e.entry){var r=t.entries.indexOf(e.entry.urn);if(r!==-1){t.entries[r]=e.entry}else{t.entries.push(e.entry)}l({method:"POST",urn:e.entry.urn,data:e.entry._options.persisted,remote:false},e.entry);t._options.persisted=t.toJSON();l({method:"POST",urn:t.urn,data:t._options.persisted,remote:false},t)}};var y=function W(e,t,r){r=r||this;var a=t.data.body||t.data;var s,u,l=false,c;if(r._options.collection===true){var p=n(a.urn);var h=i(a.urn);var d=typeof h!=="undefined"?h.queryOne({filter:{urn:a.urn}}):undefined;switch(e){case"posted":if(typeof d==="undefined"&&p){d=new p(a);if(o[d.urn]&&o[d.urn].dfd){o[d.urn].dfd.resolve(d)}else{c=new _.Dfd;o[d.urn]=o[d.urn]||{promise:c.promise()}}v({entry:d},h)}else{if(o[d.urn]&&o[d.urn].dfd){o[d.urn].dfd.resolve(d)}_.extend(d,a)}u=true;l=true;break}s=d}else{var y;switch(e){case"putted":if(typeof r!=="undefined"){for(y in r){if(y!=="_options"){delete r[y]}}}case"patched":for(y in r._options.keys){r[y]=typeof a[y]!=="undefined"?a[y]:r[y]}for(y in r._options.refs){if(typeof a[y]!=="undefined"){if(!r[y]){r[y]=a[y];u=true}else if(_.isNormalObject(r[y])&&r[y].urn&&(!(r[y]instanceof _.Model)||r[y].urn!==a[y])){r[y]=a[y];u=true}else if(_.isArray(r[y])){var g=_.pluck(r[y],"urn");if(!_.isEqual(r[y],a[y])){r[y]=a[y];u=true}}else if(_.isUrn(r[y])){r[y]=a[y];u=true}}}l=true;break}s=r}if(u===true){s._options.inited=f(s)}if(l===true){s._options.inited.done(function(){if(c){c.resolve()}s.dispatch({event:e,data:s});if(e==="putted"||e==="patched"){s.changed()}})}return s};var g=function H(e,t){t=t||this;t._options.subs.forEach(function(e){t.off({sub:e})});t.dispatch({event:"deleted",data:e})};var m=function K(e,t){if(_.isFunction(e._options.keys[t].default)){e[t]=e._options.keys[t].default()}else{switch(e._options.keys[t].type.toLowerCase()){case"object":e[t]=e._options.keys[t].default||{};break;case"array":e[t]=e._options.keys[t].default||[];break;case"boolean":e[t]=e._options.keys[t].default||false;break;case"string":e[t]=e._options.keys[t].default||"";break;case"number":e[t]=e._options.keys[t].default||NaN;break;case"date":e[t]=e._options.keys[t].default||0;break;case"regex":e[t]=e._options.keys[t].default||new Regex;break}}};var b=function X(e,t){var r;for(r in t._options.refs){if(_.isArray(t._options.refs[r])){t[r]=t[r]||[]}else{t[r]=t[r]||null}}for(r in t._options.keys){m(t,r)}for(r in t._options.virtuals){t.virtuals[r].getter=t.virtuals[r].getter.bind(t);t.virtuals[r].setter=t.virtuals[r].getter.bind(t)}for(r in e){t[r]=e[r]}};var D=function Q(e,r){r=r||this;e=e||{};r._options.fetched=new _.Dfd;if(r._options.collection===true){t[r._options.name]={regex:_.createRegex({urn:r._options.urn+":*"}),collection:r};if(_.isString(r._options.rootUrn)){r.urn=r._options.rootUrn}else if(_.isString(r._options.urn)){r.urn=r._options.urn}if(_.isArray(r._options.subscriptions)&&self&&self.Jive&&self.Jive.SessionBridge){if(r._options.collection===true){r._options.fetched.done(function(e){for(var t=0;t<e._options.subscriptions.length;t++){self.Jive.SessionBridge.subscribe({urn:e._options.subscriptions[t],ETag:e._options.ETag})}})}}r.insert=v.bind(r)}r._options.persisted=r.toJSON();b(e,r);r._options.inited=f(r);r._options.subs=[];if(typeof self!=="undefined"&&self.Jive&&self.Jive.Jazz){r._options.pubsub=self.Jive.Jazz}else{r._options.pubsub=new _.Fabric}r._options.postFunc=y.bind(r,"posted");r._options.putFunc=y.bind(r,"putted");r._options.patchFunc=y.bind(r,"patched");r._options.deleteFunc=g.bind(r);r._options.persisted=r.toJSON();if(r._options.collection===true){r.on({event:"posted",session:true}).progress(function(e){r._options.postFunc(e)})}else{r.on({event:"putted",session:true}).progress(function(e){r._options.putFunc({data:e.data.body})});r.on({event:"patched",session:true}).progress(function(e){r._options.patchFunc({data:e.data.body})});r.on({event:"deleted",session:true}).progress(function(e){r._options.deleteFunc()})}};var w=function(e,t){var r=this;e=e||{};t=t||{};r._options={_excludes:{_options:true}};r.initialize(e);return r};w.prototype=Object.create(Object.prototype);w.prototype.initialize=function(e,t){t=t||this;e=e||{}};var j={};w.prototype.get=function(e,t){t=t||this;e=e||{};var r=new _.Dfd;if(j[t.urn+JSON.stringify(e)]){return j[t.urn+JSON.stringify(e)]}if(e.urn||e.force||!t._options.ttl||t._options.ttl&&(new Date).getTime()>t._options.ttl){var o=l({method:"GET",urn:t.urn,data:e},t).done(function a(o){if(_.isNormalObject(o.data)){if(t._options.collection===true){t.entries=t.entries||[];t._options.ETag=o.data.ETag;for(var a=0;a<o.data.entries.length;a++){if(_.isNormalObject(o.data.entries[a])&&_.isUrn(o.data.entries[a].urn)){var s=t&&t.queryOne({filter:{urn:o.data.entries[a].urn}});if(s){s.set(o.data.entries[a]);setTimeout(function(e){l({method:"POST",urn:e.urn,data:e.toJSON(),remote:false},e)},0,s)}else{var u=n(o.data.entries[a].urn);if(u){s=new u(o.data.entries[a]);setTimeout(function(e){l({method:"POST",urn:e.urn,data:e.toJSON(),remote:false},e)},0,s);t.entries.push(s)}}}else{t.entries.push(o.data.entries[a])}}}else{for(var c in o.data){t[c]=o.data[c]}var p=i(t.urn);if(p){var h=p.queryOne({filter:{urn:t.urn}});var d;if(h){d=p.entries.indexOf(h);p.entries[d]=t}else{d=p.entries.indexOf(t.urn);if(d!==-1){p.entries[d]=t}else{p.entries.push(t)}}}}t._options.persisted=t.toJSON();if(o.headers["cache-control"]!=="no-cache"&&o.headers.expires){t._options.ttl=new Date(o.headers.expires).getTime();t._options.lastModified=new Date(o.headers["last-modified"]).getTime()}else{t._options.ttl=Date.now()}setTimeout(function(){l({method:"POST",urn:t.urn,data:t._options.persisted,remote:false},t)},0);t._options.inited=f(t,{local:o.local}).done(function(){if(t._options.fetched){t._options.fetched.resolve(t)}delete j[t.urn+JSON.stringify(e)];r.resolve(t)});t._options.inited.done(function(){t.dispatch({event:"gotted",data:t})})}else{delete j[t.urn+JSON.stringify(e)];r.reject("Ret was noooo good.")}}).fail(function(n){delete j[t.urn+JSON.stringify(e)];r.reject(n.error)});j[t.urn+JSON.stringify(e)]=r}else{delete j[t.urn+JSON.stringify(e)];r.resolve(t)}return r.promise()};w.prototype.post=function(e,t){t=t||this;e=e||{};var r=new _.Dfd;o[t.urn]=o[t.urn]||{dfd:r,promise:r.promise()};return l({method:"POST",urn:t.urn,data:e},t)};w.prototype.put=function(e,t){t=t||this;e=e||{};return l({method:"PUT",urn:t.urn,data:e},t)};w.prototype.patch=function(e,t){t=t||this;e=e||{};return l({method:"PATCH",urn:t.urn,data:e},t)};w.prototype["delete"]=function(e,t){t=t||this;e=e||{};return l({method:"DELETE",urn:t.urn,data:e},t)};w.prototype.options=function(e,t){t=t||this;e=e||{};var r=new _.Dfd;return l({method:"OPTIONS",urn:t.urn,data:e},t).done(function(n){for(var i in e){t._options[i]=e[i]}r.resolve(t)})};w.prototype.head=function(e,t){t=t||this;e=e||{};var r=new _.Dfd;return l({method:"HEAD",urn:t.urn,data:e},t).done(function(e){r.resolve(e.headers)})};var k=function(e,t){var r=t.shift();if(t.length===0){return e[r]}if(_.isNormalObject(e[r])){return k(e[r],t)}else if(_.isArray(e[r])){var n=[];for(var i=0;i<e[r].length;i++){var o=_.clone(t);n[i]=k(e[r][i],o)}return n}};var E=function(e,t,r){var n=t.split(".");if(typeof e[t]==="undefined"&&_.isNormalObject(e.virtuals)&&e.virtuals[t]&&_.isFunction(e.virtuals[t].getter)){return e.virtuals[t].getter(r,e)}else{return k(e,n)}};var C=function(e,t,r){var n=t.shift();if(t.length===0){e[n]=r;return e}else{e[n]=e[n]||{};return C(e[n],t,r)}};var O=function(e,t,r){var n=t.split(".");return C(e,n,r)};var S=function(e,t){if(typeof t===undefined){t=e;e={}}var r=e;for(var n in t){var i=n.split(".");for(var o=0;o<i.length-1;o++){e[i[o]]=e[i[o]]||{};e=e[i[o]]}e[i[o]]=t[n]}return r};var x=function(e,t){if(_.isRegExp(e)){if(!e.test(t)){return false}}else if(e!=t){return false}return true};var A=function(e,t,r,n){if(r){for(var i in t){if(e&&e._options&&e._options.refs&&e._options.refs[i]){t[i+".urn"]=t[i];delete t[i];i=i+".urn"}var o=E(e,i),a,s,u;if(_.isNormalObject(t[i])){for(var f in t[i]){switch(f){case"$lt":if(o>=t[i][f]){return false}break;case"$gt":if(o<=t[i][f]){return false}break;case"$lte":if(o>t[i][f]){return false}break;case"$gte":if(o<t[i][f]){return false}break;case"$btw":if(o<=t[i][f][0]||o>=t[i][f][1]){return false}break;case"$btwe":if(o<t[i][f][0]||o>t[i][f][1]){return false}break;case"$nin":s=true;a=1;case"$in":a=0;s=s||false;if(_.isArray(o)){var l=_.intersection(o,t[i][f]);if(l.length===a){return false}}else{var c=t[i][f].indexOf(o);if(s===true){if(c!==-1){return false}}else if(s===false){if(c===-1){return false}}}break;case"$all":if(_.isArray(o)){var p=_.diffValues(o,t[i][f]);if(p.added.length!==0||p.changed.length!==0||p.removed.length!==0){return false}}break;case"$neq":var h=true;case"$eq":h=h||false;if(_.isEqual(o,t[i][f])===h){return false}break;case"$alphaNumSearch":t[i][f]=(""+t[i][f]).replace(/[^\w:\-\/]/g,"").toLowerCase();if(_.isDate(o)){u=""+o.toLocaleString()}else{u=""+o}u=u.replace(/[^\w:\-\/]/g,"").toLowerCase();case"$search":u=u||o;if((""+u).indexOf(t[i][f])===-1){return false}break;case"$fuzzySearch":var d=new RegExp("\\b"+t[i][f]+"|"+t[i][f]+"\\b","i");if(!x(d,o)){return false}break;default:if(!x(t[i][f],o)){return false}break}}}else if(_.isFunction(t[i])){if(!t[i].call(e,o,e)){return false}}else{if(!x(t[i],o)){return false}}}}else if(n){if(!t.call(e,e)){return false}}return true};var T=function(e,t,r){e=e||[];e=e.sort(function n(e,i,o){o=o||0;if(o>t.length-1){return 0}var a=t[o].key;var s=E(e,a,r);var u=E(i,a,r);s=_.isDate(s)?s.getTime():s;u=_.isDate(u)?u.getTime():u;var f=t[o].order;var l=f==="desc"||f==="descending"||f==="down";var c=f==="asc"||f==="ascending"||f==="up";if(s===u||!l&&!c){o++;return n(e,i,o)}if(l){if(s>u){return-1}else{return 1}}else if(c){if(s<u){return-1}else{return 1}}else if(_.isFunction(t[o].order)){return t[o].order(s,u)}});return e};var B=function(e,t,r){var n={};t.forEach(function(t){var i=E(e,t,r);if(typeof i!=="undefined"){var o={};o[t]=i;S(n,o)}});return n};w.prototype.query=w.prototype.find=function(e,t){t=t||this;e=e||{};e.filter=e.filter||{};var r=_.isNormalObject(e.filter);var n=_.isFunction(e.filter);if(!r&&!n){throw new TypeError("If you give me a filter key, it must be an object or function")}e.key=e.key||"entries";var i=[];for(var o=0;o<t[e.key].length;o++){var a=t[e.key][o];if(typeof e.filter==="undefined"||e.filter&&A(a,e.filter,r,n,e)){var s=a;if(e.vm){if(a.toVM&&_.isFunction(a.toVM)){s=a.toVM({vm:e.vm})}else{s=_.clone(a)}}else if(e.select){s=B(a,e.select,e)}i.push(s)}}if(e.order){T(i,e.order,e)}if(e.offset){i.splice(0,e.offset)}if(e.limit===1){i=i[0]}else if(e.limit>1){i=i.splice(0,e.limit)}return i};w.prototype.queryOne=w.prototype.findOne=function(e,t){t=t||this;e=e||{};e.limit=1;return t.query(e,t)};w.prototype.dispatch=function(e,t){t=t||this;e=e||{};var r=t.urn+":";if(t._options.collection===true){r+="*:"}r+=e.event;var n=t._options.pubsub.publish({urn:r,data:e.data})};w.prototype.on=function(e,t){t=t||this;e=e||{};var r="";if(e.session===true){r+="session:"}if(t._options.collection===true){r+=t._options.urn+":*:"}else{r+=t.urn+":"}r+=e.event;var n=t._options.pubsub.subscribe({urn:r});t._options.subs.push(n);return n};w.prototype.off=function(e,t){t=t||this;e=e||{};if(typeof e.sub!=="undefined"&&typeof e.sub.id!=="undefined"){t._options.pubsub.unsubscribe({id:e.sub.id});t._options.subs=_.without(t._options.subs,sub);return true}else{return false}};w.prototype.validate=function(e,t){t=t||this;e=e||{}};w.prototype.changes=function(e,t){t=t||this;e=e||{};return t._options.changes};w.prototype.changed=function(e,t){t=t||this;e=e||{};delete F[t.urn];delete P[t.urn];var r=t.toJSON();t._options.changes=_.dirtyKeys(t._options.persisted,r);t.dispatch({event:"changed",data:t});t._options.persisted=r};w.prototype.set=function(e,t,r){r=r||this;var n={};if(typeof e==="object"&&!t){n=e}else if(typeof e==="string"&&typeof t!=="undefined"){n[e]=t}for(e in n){if(e in r._options.refs){continue}r[e]=n[e];r._options.changes=r._options.changes||{};r._options.changes[e]={aVal:r._options.persisted[e],bVal:r[e]}}r.dispatch({event:"setted",data:n});r.changed()};var F={};w.prototype.toJSON=w.prototype.valueOf=function(e,t){t=t||this;e=e||{};e.excludes=e.excludes||{};if(F[t.urn]){return F[t.urn]}var r={};_.extend(r,t._options.excludes,e.excludes);var n={};var i=Object.keys(t);for(var o=0;o<i.length;o++){if(!r[i[o]]){n[i[o]]=t[i[o]]}}for(var a in t._options.refs){if(_.isNormalObject(t[a])&&_.isUrn(t[a].urn)){n[a]=t[a].urn}else if(_.isArray(t[a])){n[a]=[];t[a].forEach(function(e,r){if(_.isNormalObject(t[a][r])&&_.isUrn(t[a][r].urn)){n[a][r]=t[a][r].urn}else{n[a][r]=t[a][r]}})}else{n[a]=t[a]}}F[t.urn]=n;return n};var P={};w.prototype.toVM=function(e,t){t=t||this;e=e||{};e.vm=e.vm||"default";var r={};P[t.urn]=P[t.urn]||{};var n=e.toVMedCacheKey||"urn";if(P[t.urn][e.vm]&&t._options.collection===false){r=P[t.urn][e.vm]}var i=e.keys||t._options.vms[e.vm];if(typeof i==="undefined"){i=t._options.vms.default}if(i==="*"||typeof i==="undefined"){i=Object.keys(t)}if(t._options.collection===true){r.entries=[];t.entries.forEach(function(t){var i;P[t[n]]=P[t[n]]||{};if(typeof P[t[n]][e.vm]==="undefined"){if(typeof t.toVM!=="undefined"&&_.isFunction(t.toVM)){i=P[t[n]][e.vm]=t.toVM({vm:e.vm})}else{i=P[t[n]][e.vm]=t}}else{i=P[t[n]][e.vm]}r.entries.push(i)})}else{P[t.urn][e.vm]=r;i.forEach(function(n){if(t._options.refs[n]){if(_.isArray(t._options.refs[n])){r[n]=[];t[n].forEach(function(t){var i;P[t.urn]=P[t.urn]||{};if(typeof P[t.urn][e.vm]==="undefined"){if(_.isFunction(t.toVM)){i=P[t.urn][e.vm]=t.toVM({vm:e.vm})}else{console.log("wasn't a function thing",t)}}else{i=P[t.urn][e.vm]}r[n].push(i)})}else if(t[n]&&t[n].urn){var i;P[t[n].urn]=P[t[n].urn]||{};if(typeof P[t[n].urn][e.vm]==="undefined"){i=P[t[n].urn][e.vm]=t[n].toVM({vm:e.vm})
}else{i=P[t[n].urn][e.vm]}r[n]=i}}else if(n==="*"){_.extend(r,t.toVM({keys:"*",vm:e.vm}))}else{var o=E(t,n,e);if(typeof o!=="undefined"){O(r,n,o)}}})}P[t.urn][e.vm]=r;return r};_.updateProp(w.prototype,{name:"get",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"post",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"put",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"patch",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"delete",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"options",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"head",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"query",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"find",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"queryOne",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"findOne",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"dispatch",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"on",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"off",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"validate",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"changes",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"changed",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"set",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"toJSON",attrs:{enumerable:false}});_.updateProp(w.prototype,{name:"toVM",attrs:{enumerable:false}});var U=function(t,n){n._options.urn=t.urn;n._options.rootUrn=t.rootUrn;n._options.name=t.name;e[n._options.urn]={regex:_.createRegex({urn:n._options.urn}),Model:n};n._options.collection=r(n._options.urn);if(typeof t.store==="undefined"){if(typeof window!=="undefined"){if(document.localStorage){n._options.store={localStorage:"Jive:Data"}}else{n._options.store={memory:"Jive.Data"}}}else{n._options.store={mongo:"mongoConnectionUrl"}}}else{n._options.store=t.store}if(typeof t.vms==="undefined"){t.vms={"default":"*"}}if(typeof t.subscriptions!=="undefined"&&n._options.collection===true){n._options.subscriptions=t.subscriptions}else if(typeof n._options.subscriptions==="undefined"&&n._options.collection===true&&n._options.urn){n._options.subscriptions=[n._options.urn,n._options.urn+":*"]}n._options.vms=t.vms;n._options.refs=t.refs||{};var i;for(i in n._options.refs){n._options.excludes[i]=true}n._options.virtuals=t.virtuals;if(typeof n._options.virtuals!=="undefined"){n.prototype.virtuals={};for(i in n._options.virtuals){n.prototype.virtuals[i]={};n.prototype.virtuals[i].getter=n._options.virtuals[i].getter||function(){};n.prototype.virtuals[i].setter=n._options.virtuals[i].setter||function(){}}}n._options.keys=t.keys||{};_.updateProp(n,{name:"_options",attrs:{enumerable:false}});_.lockProperty(n._options,"refs");_.lockProperty(n._options,"keys")};w.create=function(e){var t=function(e,r){var n=this;e=e||{};r=r||{};n._options=_.clone(t._options);_.extend(n._options,r);D(e,n);n.initialize(e);return n};t._options={excludes:{_options:true}};t.prototype=Object.create(w.prototype);U(e,t);if(e.urn[e.urn.length-1]==="*"){var r=_.clone(e);var i=e.urn.split(":");i.splice(-1);r.urn=i.join(":");r.rootUrn=e.rootUrn;if(r.store.localStore){r.store.localStore=r.urn}if(!n(r.urn)){r.refs={entries:[{type:"urn"}]};r.keys={lastModified:{type:"date"},createdDate:{type:"date"}};var o=w.create(r);new o}}return t};_.updateProp(w,{name:"create",attrs:{enumerable:false}});w.getCollections=function(){return t};_.updateProp(w,{name:"getCollections",attrs:{enumerable:false}});_.Model=w})();(function(){var e=function(){this._size=0;this._map={};this._Entry=function(e,t){this.prev=null;this.next=null;this.key=e;this.value=t};this._head=this._tail=null};var t=function(e,t){this.entry=e===null?null:e;this.property=t};t.prototype={hasNext:function(){return this.entry!==null},next:function(){if(this.entry===null){return null}var e=this.entry[this.property];this.entry=this.entry.next;return e}};e.prototype={put:function(e,t){var r;if(!this.containsKey(e)){r=new this._Entry(e,t);if(this._size===0){this._head=r;this._tail=r}else{this._tail.next=r;r.prev=this._tail;this._tail=r}this._size++}else{r=this._map[e];r.value=t}this._map[e]=r},remove:function(e){var t;if(this.containsKey(e)){this._size--;t=this._map[e];delete this._map[e];if(t===this._head){this._head=t.next;this._head.prev=null}else if(t===this._tail){this._tail=t.prev;this._tail.next=null}else{t.prev.next=t.next;t.next.prev=t.prev}}else{t=null}return t===null?null:t.value},containsKey:function(e){return this._map.hasOwnProperty(e)},containsValue:function(e){for(var t in this._map){if(this._map.hasOwnProperty(t)){if(this._map[t].value===e){return true}}}return false},get:function(e){return this.containsKey(e)?this._map[e].value:null},clear:function(){this._size=0;this._map={};this._head=this._tail=null},keys:function(e){var t=[],r=null;if(e){r=this.containsKey(e)?this._map[e]:null}else{r=this._head}for(var n=r;n!=null;n=n.next){t.push(n.key)}return t},values:function(e){var t=[],r=null;if(e){r=this.containsKey(e)?this._map[e]:null}else{r=this._head}for(var n=r;n!=null;n=n.next){t.push(n.value)}return t},iterator:function(e,r){var n="value";if(r&&(r==="key"||r==="keys")){n="key"}var i=this.containsKey(e)?this._map[e]:null;return new t(i,n)},size:function(){return this._size}};_.LinkedHashMap=e})();(function(){"use strict";function e(e){var t=e.urn.split(":");var r=[];for(var n=0;n<t.length;n++){if(t[n]=="*"){r.push("([^:]*?)")}else if(t[n]=="#"){r.push("([\\s\\S]*)")}else{r.push("("+t[n]+")")}}var i=new RegExp("^"+r.join("\\:")+"$","i");return i}_.createRegex=_.createRegex||e;var t=function(e){e=e||{};var r=0;this.__i__=function(){return r++};var n=e.peekTimeout||5e3;var i={};var o={};var a={};var s={};var u=e.replay?true:false;var f=null;if(u){if(e.persistenceProvider){f=e.persistenceProvider}else{f=new _.LinkedHashMap}}function l(e){if(e.next){e.data=e.cb.call(null,{data:e.data,matches:e.matches,raw:e.raw,binding:e.binding,key:e.key});e.index++;var t=i[e.binding].subs[e.index];e.cb=e.next;if(t){e.next=t.callback}else if(typeof e.cb==="function"){e.next=true}else{e.next=undefined}if(e.next){setTimeout(function(e){l(e)},0,e)}}else{setTimeout(function(e){e.dfd.notify({data:e.data,matches:e.matches,raw:e.raw,binding:e.binding,key:e.key});if(e.cb){e.cb.call(null,{data:e.data,matches:e.matches,raw:e.raw,binding:e.binding,key:e.key})}},0,{cb:e.cb,dfd:e.dfd,data:e.data,matches:e.matches,raw:e.raw,binding:e.binding,key:e.key})}return null}var c={};function p(e){if(!e.sync){for(var t=0;t<e.subs.length;t++){delete c.next;c.data=e.data;c.matches=e.matches;c.binding=e.loc;c.raw=e.data;c.cb=e.subs[t].callback;c.dfd=e.subs[t].dfd;c.index=t+1;c.key=e.key;l(c)}}else{c.data=e.data;c.matches=e.matches;c.binding=e.loc;c.raw=e.data;c.cb=e.subs[0].callback;c.index=1;c.key=e.key;if(e.subs[1]){c.next=e.subs[1].callback}l(c)}return null}this.subscribe=function(e){e=e||{};e.key="subscription_"+this.__i__();e.dfd=new _.Dfd;i[e.urn]=i[e.urn]||{subs:[]};i[e.urn].regex=i[e.urn].regex||_.createRegex({urn:e.urn});i[e.urn].subs.push(e);o[e.key]=e;var t=e.dfd.promise();t.key=e.key;t.id=e.id;t.callback=e.callback;return t};this.unsubscribe=function(e){e=e||{};if(_.isString(e)){e=o[e]||{}}if(e.key){e=o[e.key];delete o[e.key]}var t=i[e.urn];if(t){for(var r=0;r<t.subs.length;r++){if(e.key&&e.key==t.subs[r].key){i[e.urn].subs.splice(r,1);if(i[e.urn].subs.length==0){delete i[e.urn]}}else if(e.callback&&e.callback==t.subs[r].callback){i[e.urn].subs.splice(r,1);if(i[e.urn].subs.length==0){delete i[e.urn]}}}return e}else{return false}};var h;var d;function v(e){var t=false;d=null;for(d in i){if(e.urn==d){e.subs=i[d].subs;e.loc=d;p(e);t=true}else{h=i[d].regex.exec(e.urn);if(h){h.splice(0,1);e.matches=h;e.subs=i[d].subs;e.loc=d;p(e);t=true}}}return{published:t,key:e.key}}function y(e,t){var r,n,a=false;for(var s=0;s<t.length;s++){r=o[t[s]];if(r){e.loc=r.urn;e.subs=[r];if(e.urn==r.urn){p(e);a=true}else{h=i[r.urn].regex.exec(e.urn);if(h){h.splice(0,1);e.matches=h;p(e);a=true}}}}return{published:a,key:e.key}}this.publish=function(e){e=e||{data:{}};e.data=e.data||{};e.key=this.__i__();e.type=e.type||"publish";if(u){f.put(e.key,e)}return v(e)};this.request=function(e){e=e||{};e.data=e.data||{};e.data.key=this.__i__();e.data.cbUrn=e.urn+":"+e.data.key;e.data.type="request";e.data.key=this.subscribe({urn:e.data.cbUrn,callback:e.callback}).key;this.publish(e);return};this.fulfill=function(e){e=e||{};e.type="fulfill";var t=e.key;var r=e.urn;this.publish(e);this.unsubscribe({urn:r,key:t});return};this.command=function(e){e=e||{};e.data=e.data||{};e.data.key=this.__i__();e.data.cbUrn=e.urn+":"+e.data.key;e.data.type="command";e.data.key=this.subscribe({urn:e.data.cbUrn,callback:e.callback}).key;this.publish(e);return};this.notify=function(e){e=e||{};e.type="notify";var t=e.key;var r=e.urn;this.publish(e);this.unsubscribe({urn:r,key:t});return};this.enqueue=function(e){e=e||{};e.key="queued"+this.__i__();a[e.urn]=a[e.urn]||{items:[]};a[e.urn].regex=_.createRegex({urn:e.urn});a[e.urn].items.push(e);return e};this.dequeue=function(e){e=e||{};for(var t in a){if(e.urn==t){var r=false;var n=0;for(var i=0;i<a[t].items.length;i++){if(e.key===a[t].items[i].key){r=true;n=i;break}}if(r){a[t].items.splice(n,1);if(a[t].items.length==0){delete a[t]}}}}return};this.peek=function(e){e=e||{};e.offset=e.offset||0;var t=0;var r=null;var i=null;for(var o in a){if(e.urn==o){if(a[o].items.length>e.offset){r=a[o].items[e.offset];a[o].items.splice(e.offset,1);i=o;break}}else{var u=a[o].regex.exec(e.urn);if(u){if(a[o].items.length>e.offset){i=o;r=a[o].items[e.offset];u.splice(0,1);r.matches=u;a[o].items.splice(e.offset,1);break}}}}if(r){var f=setTimeout(function(){a[i]=a[i]||{items:[],regex:_.createRegex({urn:i})};a[i].items.unshift(r);delete s[r.key]},n);s[r.key]={message:r,timeout:f};e.callback.call(null,{data:r})}else{e.callback.call(null,{data:{}})}return};this.handle=function(e){e=e||{};var t=s[e.key];if(t){clearTimeout(t.timeout);delete s[e.key]}return};this.release=function(e){e=e||{};a[s[e.key].message.urn].items.unshift(s[e.key].message);delete s[e.key];return};this.canReplay=function(){return u};this.replay=function(e,t,r){if(!u){throw new Error("Cannot replay events since Fabric was not initialized with replay=true")}if(!f.containsKey(e)){throw new Error("Cannot replay from '"+e+"', the message ID was not found")}if(arguments.length===1){t=-1;r=null}else if(arguments.length===2){if(_.isArray(t)){r=t;t=-1}else{r=null}}var n;if(r){n=function(e){return y(e,r)}}else{n=v}var i=f.iterator(e+1);var o=0;var a;while(i.hasNext()&&(t<0||o<t)){var s=i.next();a=n(s);if(a.published){o++}}};this.id="Fabric_"+this.__i__();if(!e.debugMode){if(Object.freeze){Object.freeze(this)}if(Object.defineProperties){Object.defineProperties(t.prototype,{name:{writable:false},toString:{writable:false}})}}else{this.debug=function(){return{bindings:i,queue:a,processing:s}}}return this};_.extend(t.prototype,{name:"Fabric",toString:function(){return"[object Fabric]"}});_.Fabric=t})();